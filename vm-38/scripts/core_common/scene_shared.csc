#using scripts\core_common\scene_shared.csc;
#using script_48adcbbbccee5e60;
#using script_64914218f744517b;
#using scripts\weapons\weapon_utils.csc;
#using scripts\core_common\callbacks_shared.csc;
#using scripts\core_common\util_shared.csc;
#using scripts\core_common\system_shared.csc;
#using scripts\core_common\scriptbundle_shared.csc;
#using scripts\core_common\scene_debug_shared.csc;
#using scripts\core_common\lui_shared.csc;
#using scripts\core_common\postfx_shared.csc;
#using scripts\core_common\flag_shared.csc;
#using scripts\core_common\clientfield_shared.csc;
#using scripts\core_common\array_shared.csc;
#using scripts\core_common\animation_shared.csc;
#using scripts\core_common\struct.csc;

class csceneplayer : cscriptbundleobjectbase, csceneobject
{
	var var_8bba7189;
	var var_55b4f21e;
	var _n_clientnum;
	var _o_scene;
	var _str_shot;
	var _e_array;

	/*
		Name: constructor
		Namespace: csceneplayer
		Checksum: 0xDAB347FB
		Offset: 0x1138
		Size: 0x14
		Parameters: 0
		Flags: Linked, 8, 16
	*/
	constructor()
	{
	}

	/*
		Name: destructor
		Namespace: csceneplayer
		Checksum: 0x6980574
		Offset: 0x1158
		Size: 0x14
		Parameters: 0
		Flags: Linked, 16, 128
	*/
	destructor()
	{
	}

	/*
		Name: _play_camera_anim
		Namespace: csceneplayer
		Checksum: 0xDD69568B
		Offset: 0xB10
		Size: 0x310
		Parameters: 4
		Flags: Linked
	*/
	function _play_camera_anim(clientnum, animation, n_start_time, params)
	{
		if(!isdefined(n_start_time))
		{
			n_start_time = 0;
		}
		if(is_true(var_8bba7189))
		{
			return;
		}
		animation = csceneobject::function_9a43e31(clientnum, animation, 1);
		var_8395d6f1 = csceneobject::get_lerp_time(params, 1);
		var_8395d6f1 = int(var_8395d6f1 * 1000);
		s_align = csceneobject::function_bc0facbb(clientnum);
		align = s_align.ent;
		tag = s_align.tag;
		if(align == level)
		{
			v_pos = (0, 0, 0);
			v_ang = (0, 0, 0);
		}
		else
		{
			if(isentity(align))
			{
				/#
					loc_00000C98:
					assert(isdefined(align.model), (("" + (isdefined(animation) ? animation : "")) + "") + (isdefined(tag) ? tag : "") + "");
				#/
				v_pos = align;
				v_ang = (isdefined(tag) ? tag : "tag_origin");
			}
			else
			{
				v_pos = align.origin;
				v_ang = align.angles;
			}
		}
		var_380af598 = (isdefined(var_55b4f21e.cameraswitchername) ? var_55b4f21e.cameraswitchername : "");
		var_57949b2d = n_start_time * getcamanimtime(animation);
		var_473877de = getservertime(clientnum) - var_57949b2d;
		if(isdefined(var_55b4f21e.var_ffc10b65))
		{
			var_94f3822c = getent(clientnum, var_55b4f21e.var_ffc10b65, "targetname");
		}
		playmaincamxcam(clientnum, animation, var_8395d6f1, var_380af598, "", v_pos, v_ang, var_94f3822c, undefined, undefined, int(var_473877de));
		[[ self ]]->wait_for_camera(animation, var_57949b2d);
	}

	/*
		Name: initialize
		Namespace: csceneplayer
		Checksum: 0xAD2C0B2E
		Offset: 0x8C0
		Size: 0xC4
		Parameters: 0
		Flags: Linked
	*/
	function initialize()
	{
		flag::clear(#"ready");
		flag::clear(#"done");
		flag::clear(#"main_done");
		self notify(#"new_state");
		self endon(#"new_state");
		self notify(#"init");
		waittillframeend();
		if(isdefined(_n_clientnum))
		{
			_spawn(_n_clientnum);
		}
	}

	/*
		Name: wait_for_camera
		Namespace: csceneplayer
		Checksum: 0x840CA149
		Offset: 0xE28
		Size: 0x11C
		Parameters: 2
		Flags: Linked
	*/
	function wait_for_camera(animation, var_57949b2d)
	{
		if(!isdefined(var_57949b2d))
		{
			var_57949b2d = 0;
		}
		self endon(#"skip_camera_anims");
		flag::set(#"camera_playing");
		/#
			thread function_87208d7e();
		#/
		if(iscamanimlooping(animation))
		{
			self waittill(#"new_state");
		}
		else
		{
			n_cam_time = getcamanimtime(animation) - var_57949b2d;
			self waittilltimeout(float(n_cam_time) / 1000, #"new_state");
		}
		flag::clear(#"camera_playing");
	}

	/*
		Name: function_87208d7e
		Namespace: csceneplayer
		Checksum: 0x1C88E90
		Offset: 0xF50
		Size: 0x1DA
		Parameters: 0
		Flags: Linked
	*/
	function function_87208d7e()
	{
		/#
			level notify(#"hash_59d906960a825469");
			level endon(#"hash_59d906960a825469");
			self endon(#"new_state");
			_o_scene endon(#"stopped", #"new_state");
			while(true)
			{
				if(!getdvarint(#"scr_show_shot_info_for_igcs", 0) || !isdefined(_o_scene._str_name) || !isdefined(_o_scene._str_shot))
				{
					waitframe(1);
					continue;
				}
				v_pos = (1350, 195, 0);
				var_c74251a4 = scene::function_8582657c(_o_scene._s, _str_shot);
				var_962ef8af = (((((("" + function_9e72a96(_o_scene._str_name)) + "") + _str_shot) + "") + var_c74251a4) + "") + (var_c74251a4 * 30);
				debug2dtext(v_pos, var_962ef8af, undefined, undefined, undefined, 1, 0.8);
				v_pos = v_pos + (vectorscale((0, 1, 0), 20) * 2);
				waitframe(1);
			}
		#/
	}

	/*
		Name: _spawn
		Namespace: csceneplayer
		Checksum: 0xBFA70A11
		Offset: 0x990
		Size: 0x174
		Parameters: 2
		Flags: Linked
	*/
	function _spawn(clientnum, b_hide)
	{
		if(!isdefined(b_hide))
		{
			b_hide = 1;
		}
		if(isdefined(_e_array[clientnum]))
		{
			var_d3395a10 = 1;
		}
		else
		{
			self._e_array[clientnum] = function_5c10bd79(clientnum);
		}
		if(isdefined(level.var_762a4ab))
		{
			if(!is_true(var_d3395a10))
			{
				self [[level.var_762a4ab]](clientnum);
			}
			if(isdefined(_e_array[clientnum]) && !isplayer(_e_array[clientnum]) && _e_array[clientnum].model !== "" && b_hide && !is_true(_e_array[clientnum].var_463f8196))
			{
				_e_array[clientnum] hide();
			}
		}
		flag::set(#"ready");
	}

}

class csceneobject : cscriptbundleobjectbase
{
	var _n_clientnum;
	var _e_array;
	var _o_scene;
	var _s;
	var var_55b4f21e;
	var m_tag;
	var m_align;
	var _str_name;
	var _str_shot;
	var var_84ca3312;
	var _n_blend;
	var _b_first_frame;
	var _b_spawnonce_used;

	/*
		Name: constructor
		Namespace: csceneobject
		Checksum: 0x83A90023
		Offset: 0x1C80
		Size: 0x52
		Parameters: 0
		Flags: Linked, 8
	*/
	constructor()
	{
		self._b_spawnonce_used = 0;
		self._is_valid = 1;
		self._b_first_frame = 0;
		self._n_blend = 0;
		self.var_84ca3312 = "linear";
	}

	/*
		Name: destructor
		Namespace: csceneobject
		Checksum: 0x6D97FEFA
		Offset: 0x1CE0
		Size: 0x14
		Parameters: 0
		Flags: Linked, 128
	*/
	destructor()
	{
	}

	/*
		Name: wait_till_shot_ready
		Namespace: csceneobject
		Checksum: 0xD9D4E789
		Offset: 0x5CA8
		Size: 0x24
		Parameters: 0
		Flags: Linked
	*/
	function wait_till_shot_ready()
	{
		[[ scene() ]]->wait_till_shot_ready();
	}

	/*
		Name: in_a_different_scene
		Namespace: csceneobject
		Checksum: 0xBF2CEB67
		Offset: 0x5DB0
		Size: 0xDA
		Parameters: 0
		Flags: Linked
	*/
	function in_a_different_scene()
	{
		if(isdefined(_n_clientnum))
		{
			if(isdefined(_e_array[_n_clientnum]) && isdefined(_e_array[_n_clientnum].current_scene) && _e_array[_n_clientnum].current_scene != _o_scene._str_name)
			{
				return true;
			}
		}
		else if(isdefined(_e_array[0]) && isdefined(_e_array[0].current_scene) && _e_array[0].current_scene != _o_scene._str_name)
		{
			return true;
		}
		return false;
	}

	/*
		Name: function_9a43e31
		Namespace: csceneobject
		Checksum: 0xC14FB10
		Offset: 0x48A8
		Size: 0x572
		Parameters: 3
		Flags: Linked
	*/
	function function_9a43e31(clientnum, var_6410e385, b_camera)
	{
		if(!isdefined(b_camera))
		{
			b_camera = 0;
		}
		if(_s.type === #"fakeplayer" || _s.type === #"player")
		{
			if(isdefined(level.var_29369e8c))
			{
				str_gender = self [[level.var_29369e8c]](clientnum, (isdefined(_s.var_1b22ecf4) ? _s.var_1b22ecf4 : 0));
			}
			if(isdefined(level.var_1c6f63ee))
			{
				var_db140778 = self [[level.var_1c6f63ee]](clientnum, (isdefined(_s.var_1b22ecf4) ? _s.var_1b22ecf4 : 0));
				if(isclass(var_db140778))
				{
					weapon = [[ var_db140778 ]]->function_8567daf2().weapon;
				}
			}
			if(!isweapon(weapon) && isdefined(level.var_696537bb))
			{
				weapon = self [[level.var_696537bb]](clientnum, (isdefined(_s.var_1b22ecf4) ? _s.var_1b22ecf4 : 0));
			}
		}
		var_c4a23d1d = function_5b2306f5(weapon, str_gender, b_camera, var_db140778);
		if(isdefined(var_c4a23d1d))
		{
			return var_c4a23d1d;
		}
		if(b_camera)
		{
			if(!isdefined(weapon))
			{
				return var_6410e385;
			}
			if(weapons::ispunch(weapon))
			{
				var_c4a23d1d = var_55b4f21e.var_93cee122;
			}
			else
			{
				if(weapons::isnonbarehandsmelee(weapon))
				{
					var_c4a23d1d = var_55b4f21e.var_cc0769ae;
				}
				else
				{
					if(is_true(weapon.isrocketlauncher))
					{
						var_c4a23d1d = var_55b4f21e.var_30d1fd4b;
					}
					else if(weapons::ispistol(weapon))
					{
						var_c4a23d1d = var_55b4f21e.var_7118e947;
					}
				}
			}
		}
		else
		{
			if(!isdefined(weapon))
			{
				if(str_gender === "female")
				{
					return (isdefined(var_55b4f21e.var_1f836d8f) ? var_55b4f21e.var_1f836d8f : var_6410e385);
				}
				return var_6410e385;
			}
			if(weapons::ispunch(weapon))
			{
				if(str_gender === "female")
				{
					var_c4a23d1d = (isdefined(var_55b4f21e.var_8cf3a21a) ? var_55b4f21e.var_8cf3a21a : var_55b4f21e.var_a190f06e);
				}
				else
				{
					var_c4a23d1d = var_55b4f21e.var_a190f06e;
				}
			}
			else
			{
				if(weapons::isnonbarehandsmelee(weapon))
				{
					if(str_gender === "female")
					{
						var_c4a23d1d = (isdefined(var_55b4f21e.var_3be9d7cf) ? var_55b4f21e.var_3be9d7cf : var_55b4f21e.var_bb64ee8c);
					}
					else
					{
						var_c4a23d1d = var_55b4f21e.var_bb64ee8c;
					}
				}
				else
				{
					if(is_true(weapon.isrocketlauncher))
					{
						if(str_gender === "female")
						{
							var_c4a23d1d = (isdefined(var_55b4f21e.var_dee605a0) ? var_55b4f21e.var_dee605a0 : var_55b4f21e.var_51c09589);
						}
						else
						{
							var_c4a23d1d = var_55b4f21e.var_51c09589;
						}
					}
					else if(weapons::ispistol(weapon))
					{
						if(str_gender === "female")
						{
							var_c4a23d1d = (isdefined(var_55b4f21e.var_91ecd04) ? var_55b4f21e.var_91ecd04 : var_55b4f21e.var_389b3f9b);
						}
						else
						{
							var_c4a23d1d = var_55b4f21e.var_389b3f9b;
						}
					}
				}
			}
			if(str_gender === "female")
			{
				var_c4a23d1d = (isdefined(var_c4a23d1d) ? var_c4a23d1d : var_55b4f21e.var_1f836d8f);
			}
		}
		return (isdefined(var_c4a23d1d) ? var_c4a23d1d : var_6410e385);
	}

	/*
		Name: function_ee94f77
		Namespace: csceneobject
		Checksum: 0x29094018
		Offset: 0x2E68
		Size: 0x54
		Parameters: 2
		Flags: Linked
	*/
	function function_ee94f77(clientnum, params)
	{
		function_dd4f74e1(clientnum);
		function_587971b6(params);
		function_ebbbd00d();
	}

	/*
		Name: function_1263065a
		Namespace: csceneobject
		Checksum: 0xA9ED1D74
		Offset: 0x2558
		Size: 0xBA
		Parameters: 1
		Flags: Linked
	*/
	function function_1263065a(n_shot)
	{
		if(!isdefined(n_shot))
		{
			n_shot = 0;
		}
		var_5e0d27b8 = [];
		if(isdefined(_s.shots[n_shot]) && isdefined(_s.shots[n_shot].entry))
		{
			var_5e0d27b8 = getarraykeys(_s.shots[n_shot].entry);
			var_5e0d27b8 = array::sort_by_value(var_5e0d27b8, 1);
		}
		return var_5e0d27b8;
	}

	/*
		Name: _cleanup
		Namespace: csceneobject
		Checksum: 0x42190A28
		Offset: 0x41E8
		Size: 0x192
		Parameters: 1
		Flags: Linked
	*/
	function _cleanup(clientnum)
	{
		if(isdefined(_e_array[clientnum]) && isdefined(_e_array[clientnum].current_scene))
		{
			_e_array[clientnum] flag::clear(_o_scene._str_name);
			_e_array[clientnum] sethighdetail(0);
			if(_e_array[clientnum].current_scene == _o_scene._str_name)
			{
				_e_array[clientnum] flag::clear(#"scene");
				_e_array[clientnum].finished_scene = _o_scene._str_name;
				_e_array[clientnum].current_scene = undefined;
			}
			function_fda037ff(clientnum);
		}
		if(clientnum === _n_clientnum || clientnum == 0)
		{
			if(isdefined(_o_scene) && is_true(_o_scene.scene_stopped))
			{
				self._o_scene = undefined;
			}
		}
	}

	/*
		Name: _play_anim
		Namespace: csceneobject
		Checksum: 0x6849E515
		Offset: 0x45C8
		Size: 0x2D2
		Parameters: 9
		Flags: Linked
	*/
	function _play_anim(clientnum, animation, n_rate, n_blend, var_b2e32ae2, str_siege_shot, loop, n_start_time, params)
	{
		if(!isdefined(n_rate))
		{
			n_rate = 1;
		}
		_spawn(clientnum);
		if(is_alive(clientnum, 1))
		{
			if(!is_true(_e_array[clientnum].var_463f8196))
			{
				_e_array[clientnum] show();
			}
			if(is_true(_s.issiege))
			{
				_e_array[clientnum] animation::play_siege(animation, str_siege_shot, n_rate, loop);
			}
			else
			{
				if(is_true(loop) && is_true(_s.var_69db1665))
				{
					n_start_time = undefined;
				}
				util::waitforclient(clientnum);
				animation = function_9a43e31(clientnum, animation);
				n_lerp_time = get_lerp_time(params);
				if(is_true(loop) && is_true(_s.var_9de1f44c))
				{
					_e_array[clientnum] animation::play(animation, _e_array[clientnum], m_tag, n_rate, n_blend, undefined, n_lerp_time, undefined, n_start_time, var_b2e32ae2, clientnum);
				}
				else
				{
					update_alignment(clientnum);
					_e_array[clientnum] animation::play(animation, m_align, m_tag, n_rate, n_blend, undefined, n_lerp_time, undefined, n_start_time, var_b2e32ae2, clientnum);
				}
			}
		}
		else
		{
			/#
				cscriptbundleobjectbase::log(("" + animation) + "");
			#/
		}
		self._is_valid = is_alive(clientnum);
	}

	/*
		Name: restore_saved_ent
		Namespace: csceneobject
		Checksum: 0x80E11126
		Offset: 0x1D60
		Size: 0xC4
		Parameters: 1
		Flags: Linked
	*/
	function restore_saved_ent(clientnum)
	{
		if(isdefined(_o_scene._e_root) && isdefined(_o_scene._e_root.scene_ents) && isdefined(_o_scene._e_root.scene_ents[clientnum]))
		{
			if(isdefined(_o_scene._e_root.scene_ents[clientnum][_str_name]))
			{
				self._e_array[clientnum] = _o_scene._e_root.scene_ents[clientnum][_str_name];
			}
		}
	}

	/*
		Name: function_24562f80
		Namespace: csceneobject
		Checksum: 0x1E219AD5
		Offset: 0x51E0
		Size: 0x274
		Parameters: 3
		Flags: Linked
	*/
	function function_24562f80(var_de282754, weapon, b_camera)
	{
		if(!isdefined(b_camera))
		{
			b_camera = 0;
		}
		if(isarray(var_de282754.var_3efad56d) && var_de282754.var_3efad56d.size)
		{
			foreach(var_77ff2a12 in var_de282754.var_3efad56d)
			{
				if(isdefined(var_77ff2a12.attachment) && weaponhasattachment(weapon, var_77ff2a12.attachment))
				{
					if(b_camera && isdefined(var_77ff2a12.camera))
					{
						return var_77ff2a12.camera;
					}
					if(!b_camera && isdefined(var_77ff2a12.animation))
					{
						return var_77ff2a12.animation;
					}
				}
			}
			foreach(var_77ff2a12 in var_de282754.var_3efad56d)
			{
				if(isdefined(var_77ff2a12.attachmentgroup) && function_cd84dead(weapon, var_77ff2a12.attachmentgroup))
				{
					if(b_camera && isdefined(var_77ff2a12.camera))
					{
						return var_77ff2a12.camera;
					}
					if(!b_camera && isdefined(var_77ff2a12.animation))
					{
						return var_77ff2a12.animation;
					}
				}
			}
		}
		if(b_camera && isdefined(var_de282754.camera))
		{
			return var_de282754.camera;
		}
		if(!b_camera && isdefined(var_de282754.animation))
		{
			return var_de282754.animation;
		}
	}

	/*
		Name: run_wait
		Namespace: csceneobject
		Checksum: 0x61CE8326
		Offset: 0x2620
		Size: 0x56
		Parameters: 1
		Flags: Linked
	*/
	function run_wait(wait_time)
	{
		wait_start_time = 0;
		while(wait_start_time < wait_time && !is_skipping_scene())
		{
			wait_start_time = wait_start_time + 0.016;
			waitframe(1);
		}
	}

	/*
		Name: is_alive
		Namespace: csceneobject
		Checksum: 0x85833676
		Offset: 0x5D08
		Size: 0x9A
		Parameters: 2
		Flags: Linked
	*/
	function is_alive(clientnum, var_7081273e)
	{
		if(!isdefined(var_7081273e))
		{
			var_7081273e = 0;
		}
		if(var_7081273e)
		{
			if(isplayer(_e_array[clientnum]))
			{
				return 0;
			}
			return isdefined(_e_array[clientnum]) && _e_array[clientnum].model !== "";
		}
		return isdefined(_e_array[clientnum]);
	}

	/*
		Name: initialize
		Namespace: csceneobject
		Checksum: 0x98901B9A
		Offset: 0x1E30
		Size: 0x364
		Parameters: 0
		Flags: Linked
	*/
	function initialize()
	{
		flag::clear(#"ready");
		flag::clear(#"done");
		flag::clear(#"main_done");
		self notify(#"new_state");
		self endon(#"new_state");
		self notify(#"init");
		waittillframeend();
		self._str_shot = scene::function_de6a7579(_o_scene._str_name, "init", _o_scene._e_root);
		self.var_55b4f21e = function_730a4c60(_str_shot);
		cscriptbundleobjectbase::error(!isdefined(var_55b4f21e), ("Shot struct is not defined for this object. Check and make sure that \"" + _str_shot) + "\" is a valid shot name for this scene bundle");
		if(isdefined(_n_clientnum))
		{
			_spawn(_n_clientnum, is_true(_s.firstframe) || isdefined(_s.initanim) || isdefined(_s.initanimloop));
		}
		else
		{
			_spawn(0, is_true(_s.firstframe) || isdefined(_s.initanim) || isdefined(_s.initanimloop));
			var_2d560016 = getmaxlocalclients();
			for(clientnum = 1; clientnum < var_2d560016; clientnum++)
			{
				if(isdefined(function_5c10bd79(clientnum)))
				{
					_spawn(clientnum, is_true(_s.firstframe) || isdefined(_s.initanim) || isdefined(_s.initanimloop));
				}
			}
		}
		if(isdefined(_n_clientnum))
		{
			thread initialize_per_client(_n_clientnum);
		}
		else
		{
			for(clientnum = 1; clientnum < getmaxlocalclients(); clientnum++)
			{
				if(isdefined(function_5c10bd79(clientnum)))
				{
					thread initialize_per_client(clientnum);
				}
			}
			initialize_per_client(0);
		}
	}

	/*
		Name: function_4b3d4226
		Namespace: csceneobject
		Checksum: 0xF0B06BDB
		Offset: 0x3FA8
		Size: 0x234
		Parameters: 1
		Flags: Linked
	*/
	function function_4b3d4226(clientnum)
	{
		if(!isdefined(_e_array[clientnum]) || !isdefined(var_55b4f21e))
		{
			return;
		}
		if(is_true(var_55b4f21e.preparedelete))
		{
			_e_array[clientnum] delete();
			return;
		}
		if(isdefined(var_55b4f21e.var_3cd248f5))
		{
			a_ents = getentarray(clientnum, var_55b4f21e.var_3cd248f5, "targetname");
			array::run_all(a_ents, &hide);
		}
		else if(isdefined(var_55b4f21e.var_b94164e))
		{
			a_ents = getentarray(clientnum, var_55b4f21e.var_b94164e, "targetname");
			array::run_all(a_ents, &show);
		}
		if(!is_true(_e_array[clientnum].var_463f8196))
		{
			if(is_true(var_55b4f21e.preparehide))
			{
				_e_array[clientnum] hide();
			}
			else if(is_true(var_55b4f21e.prepareshow))
			{
				_e_array[clientnum] show();
			}
		}
		if(is_true(_s.var_e2360d85))
		{
			_e_array[clientnum] setforcenocull();
		}
	}

	/*
		Name: function_54266b24
		Namespace: csceneobject
		Checksum: 0xAB3CDD1
		Offset: 0x5C08
		Size: 0x98
		Parameters: 0
		Flags: Linked
	*/
	function function_54266b24()
	{
		foreach(obj in _o_scene._a_objects)
		{
			obj flag::wait_till_clear("camera_playing");
		}
	}

	/*
		Name: function_587971b6
		Namespace: csceneobject
		Checksum: 0x1BD189DC
		Offset: 0x2F58
		Size: 0x9E
		Parameters: 1
		Flags: Linked
	*/
	function function_587971b6(params)
	{
		if(isdefined(params.blend))
		{
			self._n_blend = params.blend;
		}
		else
		{
			self._n_blend = (isdefined(var_55b4f21e.blend) ? var_55b4f21e.blend : 0);
		}
		self.var_84ca3312 = (isdefined(var_55b4f21e.var_d6272917) ? var_55b4f21e.var_d6272917 : "linear");
	}

	/*
		Name: function_5b2306f5
		Namespace: csceneobject
		Checksum: 0xA86D0A43
		Offset: 0x4E28
		Size: 0x3B0
		Parameters: 4
		Flags: Linked
	*/
	function function_5b2306f5(weapon, str_gender, b_camera, var_db140778)
	{
		if(!isdefined(b_camera))
		{
			b_camera = 0;
		}
		if(isdefined(var_55b4f21e.var_37f7b010))
		{
			var_eadfb674 = getscriptbundle(var_55b4f21e.var_37f7b010);
		}
		if(isarray(var_eadfb674.var_37f7b010) && var_eadfb674.var_37f7b010.size)
		{
			if(isdefined(var_db140778))
			{
				var_3c7940f2 = [[ var_db140778 ]]->function_b06080fb();
				var_26820123 = [[ var_db140778 ]]->function_e8b0acef();
				str_character_name = var_26820123.fullname;
				foreach(var_de282754 in var_eadfb674.var_37f7b010)
				{
					if(!isdefined(var_de282754.var_c4258839) || !isdefined(var_de282754.var_18ed9498))
					{
						continue;
					}
					if(str_character_name === var_de282754.var_c4258839 && var_3c7940f2 === var_de282754.var_18ed9498 && function_70b46cb3(var_de282754, weapon))
					{
						str_anim = function_24562f80(var_de282754, weapon, b_camera);
						if(isdefined(str_anim))
						{
							return str_anim;
						}
					}
				}
				foreach(var_de282754 in var_eadfb674.var_37f7b010)
				{
					if(!isdefined(var_de282754.var_c4258839))
					{
						continue;
					}
					if(str_character_name === var_de282754.var_c4258839 && function_70b46cb3(var_de282754, weapon))
					{
						str_anim = function_24562f80(var_de282754, weapon, b_camera);
						if(isdefined(str_anim))
						{
							return str_anim;
						}
					}
				}
			}
			foreach(var_de282754 in var_eadfb674.var_37f7b010)
			{
				if(isdefined(var_de282754.var_c4258839))
				{
					continue;
				}
				if(!isdefined(str_gender) || str_gender === var_de282754.gender && function_70b46cb3(var_de282754, weapon))
				{
					str_anim = function_24562f80(var_de282754, weapon, b_camera);
					if(isdefined(str_anim))
					{
						return str_anim;
					}
				}
			}
		}
	}

	/*
		Name: get_lerp_time
		Namespace: csceneobject
		Checksum: 0x5A40492B
		Offset: 0x38B0
		Size: 0xCC
		Parameters: 2
		Flags: Linked
	*/
	function get_lerp_time(params, b_camera)
	{
		if(!isdefined(b_camera))
		{
			b_camera = 0;
		}
		if(b_camera && isdefined(params.var_dcfaf6c7))
		{
			n_lerp_time = params.var_dcfaf6c7;
		}
		else
		{
			if(!b_camera && isdefined(params.var_4f412ea3))
			{
				n_lerp_time = params.var_4f412ea3;
			}
			else
			{
				n_lerp_time = (isdefined(var_55b4f21e.lerptime) ? var_55b4f21e.lerptime : _s.lerptime);
			}
		}
		return true;
	}

	/*
		Name: finish_per_client
		Namespace: csceneobject
		Checksum: 0xF31276B3
		Offset: 0x3220
		Size: 0x374
		Parameters: 3
		Flags: Linked
	*/
	function finish_per_client(clientnum, b_clear, b_finished)
	{
		if(!isdefined(b_clear))
		{
			b_clear = 0;
		}
		if(!isdefined(b_finished))
		{
			b_finished = 0;
		}
		if(!is_alive(clientnum))
		{
			_cleanup(clientnum);
			self._e_array[clientnum] = undefined;
			self._is_valid = 0;
		}
		flag::set(#"ready");
		flag::set(#"done");
		if(isdefined(_e_array[clientnum]))
		{
			if(!b_finished)
			{
				_e_array[clientnum] stopsounds();
			}
			if(isdefined(_o_scene) && (isplayer(_e_array[clientnum]) || function_ec3fa8f5()))
			{
				if(scene::function_b260bdcc(_o_scene._str_name, _str_shot, _o_scene._e_root) || scene::function_6a0b0afe(_o_scene._str_mode) || b_clear)
				{
					stopmaincamxcam(clientnum);
				}
			}
			else if(is_alive(clientnum) && (b_finished && is_true(_s.deletewhenfinished) || b_clear))
			{
				_e_array[clientnum] delete();
			}
		}
		else if(_s.type === #"sharedplayer" || _s.type === #"player")
		{
			result = 0;
			if(isdefined(_o_scene) && isdefined(_o_scene._str_name) && isdefined(_o_scene._e_root) && isdefined(_str_shot))
			{
				result = scene::function_b260bdcc(_o_scene._str_name, _str_shot, _o_scene._e_root) || scene::function_6a0b0afe(_o_scene._str_mode);
			}
			if(function_ec3fa8f5() && (result || b_clear))
			{
				stopmaincamxcam(clientnum);
			}
		}
		_cleanup(clientnum);
	}

	/*
		Name: play_per_client
		Namespace: csceneobject
		Checksum: 0x1A6C6CEF
		Offset: 0x2B28
		Size: 0x334
		Parameters: 4
		Flags: Linked
	*/
	function play_per_client(clientnum, n_start_time, b_looping, params)
	{
		if(!isdefined(b_looping))
		{
			b_looping = undefined;
		}
		self endon(#"new_state");
		util::waitforclient(clientnum);
		[[ self ]]->_spawn(clientnum);
		n_shot = get_shot(_str_shot);
		var_5e0d27b8 = function_1263065a(n_shot);
		function_ee94f77(clientnum, params);
		var_3f83c458 = array("blend", "cameraswitcher", "anim");
		foreach(str_entry_type in var_3f83c458)
		{
			if(!is_alive(clientnum))
			{
				break;
			}
			foreach(n_entry in var_5e0d27b8)
			{
				entry = get_entry(n_shot, n_entry, str_entry_type);
				if(isdefined(entry))
				{
					switch(str_entry_type)
					{
						case "cameraswitcher":
						{
							thread [[ self ]]->_play_camera_anim(clientnum, entry, n_start_time, params);
							break;
						}
						case "anim":
						{
							_play_anim(clientnum, entry, 1, _n_blend, var_84ca3312, _s.mainshot, b_looping, n_start_time, params);
							break;
						}
						case "blend":
						{
							self._n_blend = entry;
							break;
						}
						default:
						{
							cscriptbundleobjectbase::error(1, ("Bad timeline entry type '" + str_entry_type) + "'.");
						}
					}
				}
			}
		}
		function_54266b24();
		thread finish_per_client(clientnum, 0, 1);
	}

	/*
		Name: function_70b46cb3
		Namespace: csceneobject
		Checksum: 0x9C3E6C21
		Offset: 0x5460
		Size: 0xE8
		Parameters: 2
		Flags: Linked
	*/
	function function_70b46cb3(var_de282754, weapon)
	{
		if(isarray(var_de282754.weaponlist) && var_de282754.weaponlist.size)
		{
			foreach(s_weapon in var_de282754.weaponlist)
			{
				if(weapon.name === s_weapon.weapon)
				{
					return true;
				}
			}
		}
		if(var_de282754.weapon === weapon.name)
		{
			return true;
		}
		return false;
	}

	/*
		Name: function_71b06874
		Namespace: csceneobject
		Checksum: 0x2BAFA66D
		Offset: 0x22F0
		Size: 0x3E
		Parameters: 1
		Flags: Linked
	*/
	function function_71b06874(n_shot)
	{
		if(is_true(_s.shots[n_shot].var_51093f2d))
		{
			return false;
		}
		return true;
	}

	/*
		Name: function_730a4c60
		Namespace: csceneobject
		Checksum: 0xFAD1075E
		Offset: 0x2248
		Size: 0x9C
		Parameters: 1
		Flags: Linked
	*/
	function function_730a4c60(str_shot)
	{
		foreach(s_shot in _s.shots)
		{
			if(str_shot === s_shot.name)
			{
				return s_shot;
			}
		}
		return undefined;
	}

	/*
		Name: scene
		Namespace: csceneobject
		Checksum: 0xF0B892FA
		Offset: 0x37E0
		Size: 0xA
		Parameters: 0
		Flags: Linked
	*/
	function scene()
	{
		return _o_scene;
	}

	/*
		Name: _prepare
		Namespace: csceneobject
		Checksum: 0xEF86D7C0
		Offset: 0x3D78
		Size: 0x222
		Parameters: 1
		Flags: Linked
	*/
	function _prepare(clientnum)
	{
		self.var_55b4f21e = function_730a4c60(_str_shot);
		if(!is_true(_s.issiege) && _e_array[clientnum].model !== "")
		{
			if(!_e_array[clientnum] hasanimtree())
			{
				_e_array[clientnum] useanimtree("generic");
			}
		}
		_e_array[clientnum].anim_debug_name = _s.name;
		function_4b3d4226(clientnum);
		if(_o_scene._s scene::is_igc() && (_s.type !== "prop" || is_true(_o_scene._s.var_5fb58492)))
		{
			_e_array[clientnum] sethighdetail(1);
		}
		_e_array[clientnum] flag::set(#"scene");
		_e_array[clientnum] flag::set(_o_scene._str_name);
		_e_array[clientnum].current_scene = _o_scene._str_name;
		_e_array[clientnum].finished_scene = undefined;
	}

	/*
		Name: initialize_per_client
		Namespace: csceneobject
		Checksum: 0x927C12CE
		Offset: 0x26B0
		Size: 0x264
		Parameters: 1
		Flags: Linked
	*/
	function initialize_per_client(clientnum)
	{
		self endon(#"new_state");
		util::waitforclient(clientnum);
		n_shot = get_shot(_str_shot);
		_e_array[clientnum] show();
		function_ee94f77(clientnum);
		if(isdefined(_s.shots) && isdefined(_s.shots[n_shot]) && isarray(_s.shots[n_shot].entry))
		{
			foreach(s_entry in _s.shots[n_shot].entry)
			{
				if(isdefined(s_entry.anim))
				{
					var_ad4f5efa = s_entry.anim;
					if(_b_first_frame)
					{
						_play_anim(clientnum, var_ad4f5efa, 0, undefined, _s.mainshot);
						break;
						continue;
					}
					if(isanimlooping(clientnum, var_ad4f5efa))
					{
						thread _play_anim(clientnum, var_ad4f5efa, 1, undefined, _s.mainshot);
						continue;
					}
					_play_anim(clientnum, var_ad4f5efa, 1, undefined, _s.mainshot);
				}
			}
		}
		flag::set(#"ready");
	}

	/*
		Name: update_alignment
		Namespace: csceneobject
		Checksum: 0x7BB83EE9
		Offset: 0x5550
		Size: 0x5E6
		Parameters: 1
		Flags: Linked
	*/
	function update_alignment(clientnum)
	{
		s_align = function_bc0facbb(clientnum);
		self.m_align = s_align.ent;
		self.m_tag = s_align.tag;
		var_cd4673f4 = is_true(_s.var_132e5621);
		var_2dd2901f = ((isdefined(_o_scene._s.var_922b4fc5) ? _o_scene._s.var_922b4fc5 : 0), (isdefined(_o_scene._s.var_3e692842) ? _o_scene._s.var_3e692842 : 0), (isdefined(_o_scene._s.var_be60a82b) ? _o_scene._s.var_be60a82b : 0));
		var_acf1be3a = ((isdefined(_o_scene._s.var_16999a5d) ? _o_scene._s.var_16999a5d : 0), (isdefined(_o_scene._s.var_29563fd6) ? _o_scene._s.var_29563fd6 : 0), (isdefined(_o_scene._s.var_eb00c330) ? _o_scene._s.var_eb00c330 : 0));
		var_24a7cd13 = ((isdefined(_s.var_922b4fc5) ? _s.var_922b4fc5 : 0), (isdefined(_s.var_3e692842) ? _s.var_3e692842 : 0), (isdefined(_s.var_be60a82b) ? _s.var_be60a82b : 0));
		var_75cdf4bd = ((isdefined(_s.var_16999a5d) ? _s.var_16999a5d : 0), (isdefined(_s.var_29563fd6) ? _s.var_29563fd6 : 0), (isdefined(_s.var_eb00c330) ? _s.var_eb00c330 : 0));
		var_2a3b0294 = ((isdefined(var_55b4f21e.var_922b4fc5) ? var_55b4f21e.var_922b4fc5 : 0), (isdefined(var_55b4f21e.var_3e692842) ? var_55b4f21e.var_3e692842 : 0), (isdefined(var_55b4f21e.var_be60a82b) ? var_55b4f21e.var_be60a82b : 0));
		var_f3bd6699 = ((isdefined(var_55b4f21e.var_16999a5d) ? var_55b4f21e.var_16999a5d : 0), (isdefined(var_55b4f21e.var_29563fd6) ? var_55b4f21e.var_29563fd6 : 0), (isdefined(var_55b4f21e.var_eb00c330) ? var_55b4f21e.var_eb00c330 : 0));
		if(var_2a3b0294 != (0, 0, 0))
		{
			var_d3c21d73 = var_2a3b0294;
		}
		else
		{
			if(var_24a7cd13 != (0, 0, 0))
			{
				var_d3c21d73 = var_24a7cd13;
			}
			else
			{
				var_d3c21d73 = var_2dd2901f;
			}
		}
		if(var_f3bd6699 != (0, 0, 0))
		{
			v_ang_offset = var_f3bd6699;
		}
		else
		{
			if(var_75cdf4bd != (0, 0, 0))
			{
				v_ang_offset = var_75cdf4bd;
			}
			else
			{
				v_ang_offset = var_acf1be3a;
			}
		}
		if(m_align == level)
		{
			self.m_align = (0, 0, 0) + var_d3c21d73;
			self.m_tag = (0, 0, 0) + v_ang_offset;
		}
		else
		{
			if(var_d3c21d73 != (0, 0, 0) || v_ang_offset != (0, 0, 0))
			{
				v_pos = m_align.origin + var_d3c21d73;
				if(var_cd4673f4)
				{
					v_ang = _e_array[clientnum].angles;
				}
				else
				{
					v_ang = m_align.angles + v_ang_offset;
				}
				self.m_align = {#angles:v_ang, #origin:v_pos};
			}
			else if(var_cd4673f4)
			{
				v_pos = m_align.origin;
				v_ang = _e_array[clientnum].angles;
				self.m_align = {#angles:v_ang, #origin:v_pos};
			}
		}
	}

	/*
		Name: first_init
		Namespace: csceneobject
		Checksum: 0xC9033E21
		Offset: 0x1D00
		Size: 0x56
		Parameters: 4
		Flags: Linked
	*/
	function first_init(s_objdef, o_scene, e_ent, localclientnum)
	{
		cscriptbundleobjectbase::init(s_objdef, o_scene, e_ent, localclientnum);
		_assign_unique_name();
		return self;
	}

	/*
		Name: get_shot
		Namespace: csceneobject
		Checksum: 0xA924A085
		Offset: 0x21A0
		Size: 0x9C
		Parameters: 1
		Flags: Linked
	*/
	function get_shot(str_shot)
	{
		foreach(n_shot, s_shot in _s.shots)
		{
			if(str_shot === s_shot.name)
			{
				return n_shot;
			}
		}
		return undefined;
	}

	/*
		Name: has_init_state
		Namespace: csceneobject
		Checksum: 0x8201D06C
		Offset: 0x5CD8
		Size: 0x22
		Parameters: 1
		Flags: Linked
	*/
	function has_init_state(str_scenedef)
	{
		return _s scene::_has_init_state(str_scenedef);
	}

	/*
		Name: function_bc0facbb
		Namespace: csceneobject
		Checksum: 0x284C9018
		Offset: 0x35A0
		Size: 0x234
		Parameters: 1
		Flags: Linked
	*/
	function function_bc0facbb(clientnum)
	{
		e_align = undefined;
		n_shot = get_shot(_str_shot);
		if(isdefined(n_shot) && isdefined(_s.shots[n_shot].aligntarget))
		{
			var_690ec5fb = _s.shots[n_shot].aligntarget;
			var_139e0bfc = var_55b4f21e.aligntargettag;
		}
		else
		{
			if(isdefined(_s.aligntarget) && _s.aligntarget !== _o_scene._s.aligntarget)
			{
				var_690ec5fb = _s.aligntarget;
				var_139e0bfc = _s.aligntargettag;
			}
			else
			{
				var_139e0bfc = _o_scene._s.aligntargettag;
			}
		}
		if(isdefined(var_690ec5fb))
		{
			a_scene_ents = [[ _o_scene ]]->get_ents();
			if(isdefined(a_scene_ents[clientnum][var_690ec5fb]))
			{
				e_align = a_scene_ents[clientnum][var_690ec5fb];
			}
			else
			{
				e_align = scene::get_existing_ent(clientnum, var_690ec5fb);
			}
			cscriptbundleobjectbase::error(!isdefined(e_align), ("Align target '" + (isdefined(var_690ec5fb) ? "" + var_690ec5fb : "")) + "' doesn't exist for scene object.");
		}
		if(!isdefined(e_align))
		{
			return [[ scene() ]]->function_bc0facbb(clientnum);
		}
		return {#tag:var_139e0bfc, #ent:e_align};
	}

	/*
		Name: get_entry
		Namespace: csceneobject
		Checksum: 0x3F039E8F
		Offset: 0x2338
		Size: 0xF2
		Parameters: 3
		Flags: Linked
	*/
	function get_entry(n_shot, n_entry, str_entry_type)
	{
		if(!isdefined(n_shot))
		{
			n_shot = 0;
		}
		if(isdefined(_s.shots[n_shot]) && isdefined(_s.shots[n_shot].entry) && isdefined(_s.shots[n_shot].entry[n_entry]))
		{
			if(isdefined(_s.shots[n_shot].entry[n_entry].(str_entry_type)))
			{
				entry = _s.shots[n_shot].entry[n_entry].(str_entry_type);
			}
		}
		return entry;
	}

	/*
		Name: get_name
		Namespace: csceneobject
		Checksum: 0xAB048B28
		Offset: 0x3878
		Size: 0xA
		Parameters: 0
		Flags: Linked
	*/
	function get_name()
	{
		return _str_name;
	}

	/*
		Name: play
		Namespace: csceneobject
		Checksum: 0x7456F424
		Offset: 0x2920
		Size: 0x1FC
		Parameters: 4
		Flags: Linked
	*/
	function play(str_shot, n_start_time, b_looping, params)
	{
		if(!isdefined(str_shot))
		{
			str_shot = "play";
		}
		if(!isdefined(b_looping))
		{
			b_looping = undefined;
		}
		flag::clear(#"ready");
		flag::clear(#"done");
		flag::clear(#"main_done");
		self notify(#"new_state");
		self endon(#"new_state");
		self notify(#"play");
		waittillframeend();
		[[ _o_scene ]]->function_7a1288f1(str_shot);
		self._str_shot = str_shot;
		self.var_55b4f21e = function_730a4c60(_str_shot);
		cscriptbundleobjectbase::error(!isdefined(var_55b4f21e), ("Shot struct is not defined for this object. Check and make sure that \"" + _str_shot) + "\" is a valid shot name for this scene bundle");
		if(isdefined(_n_clientnum))
		{
			play_per_client(_n_clientnum, n_start_time, b_looping, params);
		}
		else
		{
			for(clientnum = 1; clientnum < getmaxlocalclients(); clientnum++)
			{
				if(isdefined(function_5c10bd79(clientnum)))
				{
					thread play_per_client(clientnum, n_start_time, b_looping, params);
				}
			}
			play_per_client(0, n_start_time, b_looping, params);
		}
	}

	/*
		Name: finish
		Namespace: csceneobject
		Checksum: 0x480B97B0
		Offset: 0x3120
		Size: 0xF4
		Parameters: 2
		Flags: Linked
	*/
	function finish(b_clear, b_finished)
	{
		if(!isdefined(b_clear))
		{
			b_clear = 0;
		}
		if(!isdefined(b_finished))
		{
			b_finished = 0;
		}
		self notify(#"new_state");
		if(isdefined(_n_clientnum))
		{
			finish_per_client(_n_clientnum, b_clear, b_finished);
		}
		else
		{
			for(clientnum = 1; clientnum < getmaxlocalclients(); clientnum++)
			{
				if(isdefined(function_5c10bd79(clientnum)))
				{
					finish_per_client(clientnum, b_clear, b_finished);
				}
			}
			finish_per_client(0, b_clear, b_finished);
		}
	}

	/*
		Name: find_entry
		Namespace: csceneobject
		Checksum: 0x22D3BD12
		Offset: 0x2438
		Size: 0x118
		Parameters: 2
		Flags: Linked
	*/
	function find_entry(n_shot, str_entry_type)
	{
		if(!isdefined(n_shot))
		{
			n_shot = 0;
		}
		if(isdefined(_s.shots[n_shot]) && isdefined(_s.shots[n_shot].entry))
		{
			foreach(s_entry in _s.shots[n_shot].entry)
			{
				if(isdefined(s_entry.(str_entry_type)))
				{
					entry = s_entry.(str_entry_type);
					break;
				}
			}
		}
		return entry;
	}

	/*
		Name: function_dd4f74e1
		Namespace: csceneobject
		Checksum: 0x4D9DE97B
		Offset: 0x2EC8
		Size: 0x82
		Parameters: 1
		Flags: Linked
	*/
	function function_dd4f74e1(clientnum)
	{
		if(is_true(_s.firstframe) && _o_scene._str_mode == "init" && isdefined(_e_array[clientnum]))
		{
			self._b_first_frame = 1;
		}
		else
		{
			self._b_first_frame = 0;
		}
	}

	/*
		Name: _spawn
		Namespace: csceneobject
		Checksum: 0xBC6CCFD
		Offset: 0x3988
		Size: 0x3E4
		Parameters: 2
		Flags: Linked
	*/
	function _spawn(clientnum, b_hide)
	{
		if(!isdefined(b_hide))
		{
			b_hide = 1;
		}
		restore_saved_ent(clientnum);
		if(!isdefined(_e_array[clientnum]))
		{
			b_allows_multiple = [[ scene() ]]->allows_multiple();
			self._e_array[clientnum] = scene::get_existing_ent(clientnum, _str_name);
			if(!isdefined(_e_array[clientnum]) && isdefined(_s.name) && !b_allows_multiple)
			{
				self._e_array[clientnum] = scene::get_existing_ent(clientnum, _s.name);
			}
			if(!isdefined(_e_array[clientnum]) && !is_true(_s.nospawn) && !_b_spawnonce_used && isdefined(_s.model))
			{
				_e_align = function_bc0facbb(clientnum).ent;
				util::waitforclient(clientnum);
				self._e_array[clientnum] = util::spawn_anim_model(clientnum, _s.model, _e_align.origin, _e_align.angles);
				cscriptbundleobjectbase::error(!isdefined(_e_array[clientnum]), "util::spawn_anim_model returned undefined");
				if(_s.type === #"fakeplayer" || _s.type === #"player")
				{
					_e_array[clientnum] useanimtree("all_player");
					_e_array[clientnum].animtree = "all_player";
				}
				if(isdefined(_e_array[clientnum]))
				{
					if(b_hide && !is_true(_e_array[clientnum].var_463f8196))
					{
						_e_array[clientnum] hide();
					}
					_e_array[clientnum].scene_spawned = _o_scene._s.name;
				}
				else
				{
					cscriptbundleobjectbase::error(!is_true(_s.nospawn), "No entity exists with matching name of scene object.");
				}
			}
		}
		if(isdefined(_e_array[clientnum]))
		{
			[[ _o_scene ]]->assign_ent(self, _e_array[clientnum], clientnum);
			_prepare(clientnum);
		}
		flag::set(#"ready");
	}

	/*
		Name: function_ebbbd00d
		Namespace: csceneobject
		Checksum: 0x67DE5EB0
		Offset: 0x3000
		Size: 0x114
		Parameters: 0
		Flags: Linked
	*/
	function function_ebbbd00d()
	{
		if(_b_first_frame)
		{
			return;
		}
		n_spacer_min = var_55b4f21e.spacermin;
		n_spacer_max = var_55b4f21e.spacermax;
		if(!is_skipping_scene() && (isdefined(n_spacer_min) || isdefined(n_spacer_max)))
		{
			if(isdefined(n_spacer_min) && isdefined(n_spacer_max))
			{
				if(!cscriptbundleobjectbase::error(n_spacer_min >= n_spacer_max, "Spacer Min value must be less than Spacer Max value!"))
				{
					run_wait(randomfloatrange(n_spacer_min, n_spacer_max));
				}
			}
			else
			{
				if(isdefined(n_spacer_min))
				{
					run_wait(n_spacer_min);
				}
				else if(isdefined(n_spacer_max))
				{
					run_wait(n_spacer_max);
				}
			}
		}
	}

	/*
		Name: function_ec3fa8f5
		Namespace: csceneobject
		Checksum: 0x8E5185AE
		Offset: 0x5B40
		Size: 0xBC
		Parameters: 0
		Flags: Linked
	*/
	function function_ec3fa8f5()
	{
		if(isarray(var_55b4f21e.entry))
		{
			foreach(s_entry in var_55b4f21e.entry)
			{
				if(s_entry.var_71bac06 === "cameraswitcher")
				{
					return true;
				}
			}
		}
		return false;
	}

	/*
		Name: _assign_unique_name
		Namespace: csceneobject
		Checksum: 0x5689D68B
		Offset: 0x37F8
		Size: 0x76
		Parameters: 0
		Flags: Linked
	*/
	function _assign_unique_name()
	{
		if(isdefined(_s.name))
		{
			self._str_name = _s.name;
		}
		else
		{
			self._str_name = (_o_scene._str_name + "_noname") + ([[ scene() ]]->get_object_id());
		}
	}

	/*
		Name: get_orig_name
		Namespace: csceneobject
		Checksum: 0x89DC8F88
		Offset: 0x3890
		Size: 0x12
		Parameters: 0
		Flags: Linked
	*/
	function get_orig_name()
	{
		return _s.name;
	}

	/*
		Name: function_fda037ff
		Namespace: csceneobject
		Checksum: 0x3F84A07E
		Offset: 0x4388
		Size: 0x234
		Parameters: 1
		Flags: Linked
	*/
	function function_fda037ff(clientnum)
	{
		if(!isdefined(_e_array[clientnum]) || !isdefined(var_55b4f21e))
		{
			return;
		}
		if(is_true(var_55b4f21e.cleanupdelete))
		{
			_e_array[clientnum] delete();
			return;
		}
		if(isdefined(var_55b4f21e.var_39fd697b))
		{
			a_ents = getentarray(clientnum, var_55b4f21e.var_39fd697b, "targetname");
			array::run_all(a_ents, &hide);
		}
		else if(isdefined(var_55b4f21e.var_4ceff7a6))
		{
			a_ents = getentarray(clientnum, var_55b4f21e.var_4ceff7a6, "targetname");
			array::run_all(a_ents, &show);
		}
		if(!is_true(_e_array[clientnum].var_463f8196))
		{
			if(is_true(var_55b4f21e.cleanuphide))
			{
				_e_array[clientnum] hide();
			}
			else if(is_true(var_55b4f21e.cleanupshow))
			{
				_e_array[clientnum] show();
			}
		}
		if(is_true(_s.var_e2360d85))
		{
			_e_array[clientnum] removeforcenocull();
		}
	}

	/*
		Name: is_skipping_scene
		Namespace: csceneobject
		Checksum: 0xE53F173C
		Offset: 0x2680
		Size: 0x22
		Parameters: 0
		Flags: Linked
	*/
	function is_skipping_scene()
	{
		return is_true([[ _o_scene ]]->is_skipping_scene());
	}

}

class cscene : cscriptbundlebase
{
	var _a_objects;
	var _s;
	var _str_shot;
	var _str_name;
	var _e_root;
	var _a_active_shots;
	var _n_object_id;
	var var_2e9fdf35;
	var _str_mode;
	var var_b0ff34ce;
	var _testing;
	var skipping_scene;

	/*
		Name: constructor
		Namespace: cscene
		Checksum: 0xCEFDF5
		Offset: 0x6850
		Size: 0x3A
		Parameters: 0
		Flags: Linked, 8
	*/
	constructor()
	{
		self._n_object_id = 0;
		self._str_mode = "";
		self._a_active_shots = [];
	}

	/*
		Name: destructor
		Namespace: cscene
		Checksum: 0xDBAC3B95
		Offset: 0x6898
		Size: 0x14
		Parameters: 0
		Flags: Linked, 128
	*/
	destructor()
	{
	}

	/*
		Name: wait_till_shot_ready
		Namespace: cscene
		Checksum: 0xE4D7168F
		Offset: 0x8C60
		Size: 0x34
		Parameters: 0
		Flags: Linked
	*/
	function wait_till_shot_ready()
	{
		if(isdefined(_a_objects))
		{
			array::flag_wait(_a_objects, "ready");
		}
	}

	/*
		Name: get_ents
		Namespace: cscene
		Checksum: 0x71FDA7C9
		Offset: 0x8968
		Size: 0x17A
		Parameters: 0
		Flags: Linked
	*/
	function get_ents()
	{
		a_ents = [];
		for(clientnum = 0; clientnum < getmaxlocalclients(); clientnum++)
		{
			if(isdefined(function_5c10bd79(clientnum)))
			{
				a_ents[clientnum] = [];
				foreach(o_obj in _a_objects)
				{
					ent = [[ o_obj ]]->get_ent(clientnum);
					if(isdefined(o_obj._s.name))
					{
						a_ents[clientnum][o_obj._s.name] = ent;
						continue;
					}
					if(!isdefined(a_ents))
					{
						a_ents = [];
					}
					else if(!isarray(a_ents))
					{
						a_ents = array(a_ents);
					}
					a_ents[a_ents.size] = ent;
				}
			}
		}
		return a_ents;
	}

	/*
		Name: function_1013fc5b
		Namespace: cscene
		Checksum: 0xEE184275
		Offset: 0x7440
		Size: 0x2E8
		Parameters: 0
		Flags: Linked
	*/
	function function_1013fc5b()
	{
		if(isstring(_s.cameraswitcher) || ishash(_s.cameraswitcher))
		{
			a_players = getlocalplayers();
			foreach(player in a_players)
			{
				clientnum = player getlocalclientnumber();
				e_align = function_bc0facbb(clientnum).ent;
				v_pos = (isdefined(e_align.origin) ? e_align.origin : (0, 0, 0));
				v_ang = (isdefined(e_align.angles) ? e_align.angles : (0, 0, 0));
				playmaincamxcam(clientnum, _s.cameraswitcher, 0, "", "", v_pos, v_ang);
			}
			if(iscamanimlooping(_s.cameraswitcher))
			{
				self waittill(#"new_state");
			}
			else
			{
				n_cam_time = getcamanimtime(_s.cameraswitcher);
				self waittilltimeout(float(n_cam_time) / 1000, #"new_state");
			}
			a_players = getlocalplayers();
			foreach(player in a_players)
			{
				clientnum = player getlocalclientnumber();
				stopmaincamxcam(clientnum);
			}
		}
	}

	/*
		Name: function_13804c36
		Namespace: cscene
		Checksum: 0xFFEAED7F
		Offset: 0x6F40
		Size: 0x138
		Parameters: 2
		Flags: Linked
	*/
	function function_13804c36(ent, str_obj_name)
	{
		if(ent.script_animname === str_obj_name || (isstring(ent.script_animname) && tolower(ent.script_animname) === str_obj_name))
		{
			return true;
		}
		if(ent.animname === str_obj_name || (isstring(ent.animname) && tolower(ent.animname) === str_obj_name))
		{
			return true;
		}
		if(ent.targetname === str_obj_name || (isstring(ent.targetname) && tolower(ent.targetname) === str_obj_name))
		{
			return true;
		}
		return false;
	}

	/*
		Name: new_object
		Namespace: cscene
		Checksum: 0x5A62C883
		Offset: 0x68B8
		Size: 0x192
		Parameters: 1
		Flags: Linked
	*/
	function new_object(str_type)
	{
		switch(str_type)
		{
			case "prop":
			{
				return new csceneobject();
				break;
			}
			case "model":
			{
				return new csceneobject();
				break;
			}
			case "vehicle":
			{
				return new csceneobject();
				break;
			}
			case "actor":
			{
				return new csceneobject();
				break;
			}
			case "fakeactor":
			{
				return new csceneobject();
				break;
			}
			case "player":
			{
				return new csceneplayer();
				break;
			}
			case "sharedplayer":
			{
				return new csceneplayer();
				break;
			}
			case "fakeplayer":
			{
				return new csceneobject();
				break;
			}
			default:
			{
				cscriptbundlebase::error(0, ("Unsupported object type '" + str_type) + "'.");
			}
		}
	}

	/*
		Name: function_2ba44cd0
		Namespace: cscene
		Checksum: 0x7BC7CD5B
		Offset: 0x7FF0
		Size: 0xA
		Parameters: 0
		Flags: Linked
	*/
	function function_2ba44cd0()
	{
		return _str_shot;
	}

	/*
		Name: initialize
		Namespace: cscene
		Checksum: 0x942BA5D
		Offset: 0x72C8
		Size: 0x14C
		Parameters: 1
		Flags: Linked
	*/
	function initialize(b_playing)
	{
		if(!isdefined(b_playing))
		{
			b_playing = 0;
		}
		self notify(#"new_state");
		self endon(#"new_state");
		_s scene::function_585fb738();
		if(get_valid_objects().size > 0)
		{
			level flag::set(_str_name + "_initialized");
			self._str_mode = "init";
			foreach(o_obj in _a_objects)
			{
				thread [[ o_obj ]]->initialize();
			}
			if(!b_playing)
			{
				thread _call_state_funcs("init");
			}
		}
	}

	/*
		Name: get_valid_objects
		Namespace: cscene
		Checksum: 0x220A48A2
		Offset: 0x8CD0
		Size: 0xF2
		Parameters: 0
		Flags: Linked
	*/
	function get_valid_objects()
	{
		a_obj = [];
		foreach(obj in _a_objects)
		{
			if(obj._is_valid && !([[ obj ]]->in_a_different_scene()))
			{
				if(!isdefined(a_obj))
				{
					a_obj = [];
				}
				else if(!isarray(a_obj))
				{
					a_obj = array(a_obj);
				}
				a_obj[a_obj.size] = obj;
			}
		}
		return a_obj;
	}

	/*
		Name: allows_multiple
		Namespace: cscene
		Checksum: 0xAE95480E
		Offset: 0x8BC8
		Size: 0x8
		Parameters: 0
		Flags: Linked
	*/
	function allows_multiple()
	{
		return true;
	}

	/*
		Name: on_error
		Namespace: cscene
		Checksum: 0x562586F3
		Offset: 0x8DD0
		Size: 0x14
		Parameters: 0
		Flags: Linked
	*/
	function on_error()
	{
		stop();
	}

	/*
		Name: get_root
		Namespace: cscene
		Checksum: 0x5B0C00A0
		Offset: 0x8AF0
		Size: 0xA
		Parameters: 0
		Flags: Linked
	*/
	function get_root()
	{
		return _e_root;
	}

	/*
		Name: function_6a55f153
		Namespace: cscene
		Checksum: 0x50E5E4BA
		Offset: 0x8CA0
		Size: 0x24
		Parameters: 0
		Flags: Linked
	*/
	function function_6a55f153()
	{
		array::flag_wait(_a_objects, "done");
	}

	/*
		Name: function_7a1288f1
		Namespace: cscene
		Checksum: 0x32C33D0D
		Offset: 0x7D68
		Size: 0x110
		Parameters: 1
		Flags: Linked
	*/
	function function_7a1288f1(str_shot)
	{
		if(!isdefined(_a_active_shots))
		{
			self._a_active_shots = [];
		}
		else if(!isarray(_a_active_shots))
		{
			self._a_active_shots = array(_a_active_shots);
		}
		if(!isinarray(_a_active_shots, str_shot))
		{
			self._a_active_shots[_a_active_shots.size] = str_shot;
		}
		if(isarray(level.inactive_scenes[_str_name]))
		{
			arrayremovevalue(level.inactive_scenes[_str_name], _e_root);
			if(level.inactive_scenes[_str_name].size == 0)
			{
				level.inactive_scenes[_str_name] = undefined;
			}
		}
	}

	/*
		Name: is_looping
		Namespace: cscene
		Checksum: 0xCF8A9A65
		Offset: 0x8BD8
		Size: 0x22
		Parameters: 0
		Flags: Linked
	*/
	function is_looping()
	{
		return is_true(_s.looping);
	}

	/*
		Name: stop
		Namespace: cscene
		Checksum: 0x8ED0969B
		Offset: 0x8158
		Size: 0x35E
		Parameters: 2
		Flags: Linked
	*/
	function stop(b_clear, b_finished)
	{
		if(!isdefined(b_clear))
		{
			b_clear = 0;
		}
		if(!isdefined(b_finished))
		{
			b_finished = 0;
		}
		self notify(#"new_state");
		level flag::clear(_str_name + "_playing");
		level flag::clear(_str_name + "_initialized");
		self._str_mode = "";
		thread _call_state_funcs("stop");
		self.scene_stopped = 1;
		foreach(o_obj in _a_objects)
		{
			if(isdefined(o_obj) && !([[ o_obj ]]->in_a_different_scene()))
			{
				thread [[ o_obj ]]->finish(b_clear, b_finished);
			}
		}
		self notify(#"stopped", {#is_finished:b_finished});
		if(isdefined(level.active_scenes[_str_name]))
		{
			arrayremovevalue(level.active_scenes[_str_name], _e_root);
			if(level.active_scenes[_str_name].size == 0)
			{
				level.active_scenes[_str_name] = undefined;
			}
		}
		if(isdefined(_e_root) && isdefined(_e_root.scenes))
		{
			arrayremovevalue(_e_root.scenes, self);
			if(_e_root.scenes.size == 0)
			{
				_e_root.scenes = undefined;
			}
			_e_root notify(#"scene_done", {#scenedef:_str_name});
			if(isdefined(_e_root.scene_played))
			{
				foreach(var_74f5d118 in _e_root.scene_played)
				{
					var_74f5d118 = 1;
				}
			}
		}
		self notify(#"scene_done", {#scenedef:_str_name});
	}

	/*
		Name: init
		Namespace: cscene
		Checksum: 0xFDDDACD7
		Offset: 0x6A58
		Size: 0x4DC
		Parameters: 5
		Flags: Linked
	*/
	function init(str_scenedef, s_scenedef, e_align, a_ents, b_test_run)
	{
		cscriptbundlebase::init(str_scenedef, s_scenedef, b_test_run);
		if(!isdefined(a_ents))
		{
			a_ents = [];
		}
		else if(!isarray(a_ents))
		{
			a_ents = array(a_ents);
		}
		if(!cscriptbundlebase::error(a_ents.size > _s.objects.size, "Trying to use more entities than scene supports."))
		{
			self._e_root = e_align;
			if(!isdefined(level.inactive_scenes))
			{
				level.inactive_scenes = [];
			}
			if(!isdefined(level.active_scenes[_str_name]))
			{
				level.active_scenes[_str_name] = [];
			}
			else if(!isarray(level.active_scenes[_str_name]))
			{
				level.active_scenes[_str_name] = array(level.active_scenes[_str_name]);
			}
			level.active_scenes[_str_name][level.active_scenes[_str_name].size] = _e_root;
			if(!isdefined(_e_root.scenes))
			{
				_e_root.scenes = [];
			}
			else if(!isarray(_e_root.scenes))
			{
				_e_root.scenes = array(_e_root.scenes);
			}
			_e_root.scenes[_e_root.scenes.size] = self;
			a_objs = get_valid_object_defs();
			foreach(var_8713eed1, e_ent in arraycopy(a_ents))
			{
				foreach(s_obj in arraycopy(a_objs))
				{
					if(s_obj.name === (isdefined(var_8713eed1) ? "" + var_8713eed1 : "") || function_13804c36(e_ent, s_obj.name))
					{
						cscriptbundlebase::add_object([[ [[ self ]]->new_object(s_obj.type) ]]->first_init(s_obj, self, e_ent, _e_root.localclientnum));
						arrayremoveindex(a_ents, var_8713eed1);
						arrayremoveindex(a_objs, i);
						break;
					}
				}
			}
			foreach(s_obj in a_objs)
			{
				cscriptbundlebase::add_object([[ [[ self ]]->new_object(s_obj.type) ]]->first_init(s_obj, self, array::pop(a_ents), _e_root.localclientnum));
			}
			self thread initialize();
		}
	}

	/*
		Name: play_endon
		Namespace: cscene
		Checksum: 0xEDF79B75
		Offset: 0x7C48
		Size: 0x24
		Parameters: 1
		Flags: Linked
	*/
	function play_endon(var_a27f7ab4)
	{
		function_ea4a6812(_str_shot);
	}

	/*
		Name: has_init_state
		Namespace: cscene
		Checksum: 0xE4633522
		Offset: 0x84C0
		Size: 0xAA
		Parameters: 0
		Flags: Linked
	*/
	function has_init_state()
	{
		b_has_init_state = 0;
		foreach(o_scene_object in _a_objects)
		{
			if([[ o_scene_object ]]->has_init_state(_str_name))
			{
				b_has_init_state = 1;
				break;
			}
		}
		return b_has_init_state;
	}

	/*
		Name: get_valid_object_defs
		Namespace: cscene
		Checksum: 0x396E1F41
		Offset: 0x7120
		Size: 0x19A
		Parameters: 0
		Flags: Linked
	*/
	function get_valid_object_defs()
	{
		a_obj_defs = [];
		foreach(s_obj in _s.objects)
		{
			if(_s.vmtype === "client" || s_obj.vmtype === "client")
			{
				if(isdefined(s_obj.name) || isdefined(s_obj.model) || isdefined(s_obj.initanim) || isdefined(s_obj.mainanim))
				{
					if(!is_true(s_obj.disabled) && scene::function_6f382548(s_obj, _s.name))
					{
						if(!isdefined(a_obj_defs))
						{
							a_obj_defs = [];
						}
						else if(!isarray(a_obj_defs))
						{
							a_obj_defs = array(a_obj_defs);
						}
						a_obj_defs[a_obj_defs.size] = s_obj;
					}
				}
			}
		}
		return a_obj_defs;
	}

	/*
		Name: get_object_id
		Namespace: cscene
		Checksum: 0xBBA76107
		Offset: 0x7420
		Size: 0x16
		Parameters: 0
		Flags: Linked
	*/
	function get_object_id()
	{
		self._n_object_id++;
		return _n_object_id;
	}

	/*
		Name: _call_state_funcs
		Namespace: cscene
		Checksum: 0x301D497C
		Offset: 0x8578
		Size: 0x3E2
		Parameters: 1
		Flags: Linked
	*/
	function _call_state_funcs(str_state)
	{
		self endon(#"stopped");
		wait_till_shot_ready();
		if(str_state == "play")
		{
			waittillframeend();
		}
		level notify((_str_name + "_") + str_state);
		if(isdefined(level.scene_funcs) && isdefined(level.scene_funcs[_str_name]) && isdefined(level.scene_funcs[_str_name][str_state]))
		{
			a_all_ents = get_ents();
			foreach(clientnum, a_ents in a_all_ents)
			{
				foreach(handler in level.scene_funcs[_str_name][str_state])
				{
					func = handler[0];
					args = handler[1];
					switch(args.size)
					{
						case 6:
						{
							_e_root thread [[func]](clientnum, a_ents, args[0], args[1], args[2], args[3], args[4], args[5]);
							break;
						}
						case 5:
						{
							_e_root thread [[func]](clientnum, a_ents, args[0], args[1], args[2], args[3], args[4]);
							break;
						}
						case 4:
						{
							_e_root thread [[func]](clientnum, a_ents, args[0], args[1], args[2], args[3]);
							break;
						}
						case 3:
						{
							_e_root thread [[func]](clientnum, a_ents, args[0], args[1], args[2]);
							break;
						}
						case 2:
						{
							_e_root thread [[func]](clientnum, a_ents, args[0], args[1]);
							break;
						}
						case 1:
						{
							_e_root thread [[func]](clientnum, a_ents, args[0]);
							break;
						}
						case 0:
						{
							_e_root thread [[func]](clientnum, a_ents);
							break;
						}
						default:
						{
							/#
								assertmsg("");
							#/
						}
					}
				}
			}
		}
	}

	/*
		Name: function_bc0facbb
		Namespace: cscene
		Checksum: 0x2468F6DA
		Offset: 0x8B08
		Size: 0xB4
		Parameters: 1
		Flags: Linked
	*/
	function function_bc0facbb(clientnum)
	{
		e_align = _e_root;
		if(isdefined(_s.aligntarget))
		{
			e_gdt_align = scene::get_existing_ent(clientnum, _s.aligntarget);
			if(isdefined(e_gdt_align))
			{
				e_align = e_gdt_align;
			}
			var_139e0bfc = _s.aligntargettag;
		}
		return {#tag:var_139e0bfc, #ent:e_align};
	}

	/*
		Name: get_next_shot
		Namespace: cscene
		Checksum: 0xDD260F10
		Offset: 0x8008
		Size: 0x144
		Parameters: 0
		Flags: Linked
	*/
	function get_next_shot()
	{
		if(_s.scenetype === "scene")
		{
			if(isdefined(var_2e9fdf35))
			{
				var_1a15e649 = var_2e9fdf35;
				self.var_2e9fdf35 = undefined;
				return var_1a15e649;
			}
			a_shots = scene::get_all_shot_names(_str_name, _e_root);
			foreach(i, str_shot in a_shots)
			{
				if(str_shot === _a_active_shots[0] && isdefined(a_shots[i + 1]))
				{
					return a_shots[i + 1];
				}
			}
		}
		else
		{
		}
	}

	/*
		Name: play
		Namespace: cscene
		Checksum: 0x3AC06B8
		Offset: 0x7730
		Size: 0x50C
		Parameters: 5
		Flags: Linked
	*/
	function play(str_shot, b_testing, str_mode, b_looping, params)
	{
		if(!isdefined(str_shot))
		{
			str_shot = "play";
		}
		if(!isdefined(b_testing))
		{
			b_testing = 0;
		}
		if(!isdefined(str_mode))
		{
			str_mode = "";
		}
		if(!isdefined(b_looping))
		{
			b_looping = undefined;
		}
		level endon(#"demo_jump");
		self notify(str_shot + "start");
		self endoncallback(&play_endon, str_shot + "start", #"new_state");
		if(issubstr(str_mode, "play_from_time"))
		{
			args = strtok(str_mode, ":");
			if(isdefined(args[1]))
			{
				var_79584e08 = float(args[1]);
			}
		}
		self._testing = b_testing;
		self._str_mode = str_mode;
		self._str_shot = str_shot;
		if(get_valid_objects().size > 0)
		{
			foreach(o_obj in _a_objects)
			{
				thread [[ o_obj ]]->play(str_shot, var_79584e08, b_looping, params);
			}
			self.n_start_time = undefined;
			level flag::set(_str_name + "_playing");
			if(!scene::function_6a0b0afe(_str_mode))
			{
				self._str_mode = "play";
			}
			wait_till_shot_ready();
			function_7a1288f1(str_shot);
			thread function_1013fc5b();
			thread _call_state_funcs(str_shot);
			function_6a55f153();
			array::function_d77ef691(_a_objects, "done", "main_done");
			if(scene::function_b260bdcc(_str_name, str_shot))
			{
				if(isdefined(_e_root))
				{
					_e_root notify(#"scene_done", {#scenedef:_str_name});
				}
				thread _call_state_funcs("done");
				self.var_b0ff34ce = 1;
			}
			if(is_looping() || _str_mode == "loop" && is_true(var_b0ff34ce))
			{
				self.var_b0ff34ce = undefined;
				if(has_init_state())
				{
					level flag::clear(_str_name + "_playing");
					thread initialize();
				}
				else
				{
					level flag::clear(_str_name + "_initialized");
					var_689ecfec = scene::function_de6a7579(_str_name, str_mode, _e_root);
					thread play(var_689ecfec, b_testing, str_mode, 1);
				}
			}
			else
			{
				if(!scene::function_6a0b0afe(_str_mode))
				{
					thread run_next(str_shot);
				}
				else
				{
					thread stop(0, 1);
				}
			}
		}
		else
		{
			thread stop(0, 1);
		}
		function_ea4a6812(str_shot);
	}

	/*
		Name: run_next
		Namespace: cscene
		Checksum: 0x938D6382
		Offset: 0x7C78
		Size: 0xE4
		Parameters: 1
		Flags: Linked
	*/
	function run_next(str_current_shot)
	{
		var_1a15e649 = get_next_shot();
		function_ea4a6812(str_current_shot);
		if(isdefined(var_1a15e649))
		{
			switch(_s.scenetype)
			{
				case "scene":
				{
					thread [[ self ]]->play(var_1a15e649, _testing, _str_mode);
					break;
				}
				default:
				{
					thread [[ self ]]->play(var_1a15e649, _testing, _str_mode);
				}
			}
		}
		else
		{
			thread stop(0, 1);
		}
	}

	/*
		Name: function_ea4a6812
		Namespace: cscene
		Checksum: 0x5A805F28
		Offset: 0x7E80
		Size: 0x164
		Parameters: 1
		Flags: Linked
	*/
	function function_ea4a6812(str_shot)
	{
		arrayremovevalue(_a_active_shots, str_shot);
		if(_a_active_shots.size == 0)
		{
			if(!isdefined(level.inactive_scenes[_str_name]))
			{
				level.inactive_scenes[_str_name] = [];
			}
			else if(!isarray(level.inactive_scenes[_str_name]))
			{
				level.inactive_scenes[_str_name] = array(level.inactive_scenes[_str_name]);
			}
			if(!isinarray(level.inactive_scenes[_str_name], _e_root))
			{
				level.inactive_scenes[_str_name][level.inactive_scenes[_str_name].size] = _e_root;
			}
			arrayremovevalue(level.inactive_scenes[_str_name], undefined);
			arrayremovevalue(level.inactive_scenes, undefined, 1);
		}
	}

	/*
		Name: assign_ent
		Namespace: cscene
		Checksum: 0x87F8FD52
		Offset: 0x7080
		Size: 0x96
		Parameters: 3
		Flags: Linked
	*/
	function assign_ent(o_obj, ent, clientnum)
	{
		if(!isdefined(_e_root.scene_ents))
		{
			_e_root.scene_ents = [];
		}
		if(!isdefined(_e_root.scene_ents[clientnum]))
		{
			_e_root.scene_ents[clientnum] = [];
		}
		_e_root.scene_ents[clientnum][o_obj._str_name] = ent;
	}

	/*
		Name: is_skipping_scene
		Namespace: cscene
		Checksum: 0x78148C68
		Offset: 0x8C08
		Size: 0x4A
		Parameters: 0
		Flags: Linked
	*/
	function is_skipping_scene()
	{
		return is_true(skipping_scene) || _str_mode == "skip_scene" || _str_mode == "skip_scene_player";
	}

}

#namespace scene_shared;

/*
	Name: function_ff4c7a25
	Namespace: scene_shared
	Checksum: 0xFA4D4BBA
	Offset: 0x6D8
	Size: 0x14
	Parameters: 0
	Flags: AutoExec, Private, 16
*/
function private autoexec function_ff4c7a25()
{
	level notify(-1343576032);
}

#namespace scene;

/*
	Name: player_scene_animation_skip
	Namespace: scene
	Checksum: 0x8ADAD6BB
	Offset: 0x6F8
	Size: 0x11C
	Parameters: 7
	Flags: Linked
*/
function player_scene_animation_skip(localclientnum, oldval, newval, bnewent, binitialsnap, fieldname, bwastimejump)
{
	anim_name = self getcurrentanimscriptedname();
	if(isdefined(anim_name) && anim_name != "")
	{
		if(!isanimlooping(bwastimejump, anim_name))
		{
			/#
				if(getdvarint(#"debug_scene_skip", 0) > 0)
				{
					printtoprightln((("" + anim_name) + "") + gettime(), vectorscale((1, 1, 1), 0.6));
				}
			#/
			self setanimtimebyname(anim_name, 1, 1);
		}
	}
}

/*
	Name: player_scene_skip_completed
	Namespace: scene
	Checksum: 0x603D52A0
	Offset: 0x820
	Size: 0x94
	Parameters: 7
	Flags: Linked
*/
function player_scene_skip_completed(localclientnum, oldval, newval, bnewent, binitialsnap, fieldname, bwastimejump)
{
	flushsubtitles(bwastimejump);
	setdvar(#"r_graphiccontentblur", 0);
	setdvar(#"r_makedark_enable", 0);
}

/*
	Name: get_existing_ent
	Namespace: scene
	Checksum: 0x20F068A
	Offset: 0x95F8
	Size: 0x6A
	Parameters: 2
	Flags: Linked
*/
function get_existing_ent(clientnum, str_name)
{
	e = getent(clientnum, str_name, "targetname");
	if(!isdefined(e))
	{
		e = struct::get(str_name, "targetname");
	}
	return e;
}

/*
	Name: __init__system__
	Namespace: scene
	Checksum: 0x1B8169CA
	Offset: 0x9670
	Size: 0x4C
	Parameters: 0
	Flags: AutoExec, Private
*/
function private autoexec __init__system__()
{
	system::register(#"scene", &function_70a657d8, &function_8ac3bea9, undefined, undefined);
}

/*
	Name: function_70a657d8
	Namespace: scene
	Checksum: 0xF5BFAD4B
	Offset: 0x96C8
	Size: 0x5A4
	Parameters: 0
	Flags: Linked, Private
*/
function private function_70a657d8()
{
	level.scenedefs = getscriptbundlenames("scene");
	level.active_scenes = [];
	level.var_1e798f4c = [];
	cp_skip_scene_menu::register();
	level.server_scenes = [];
	foreach(str_scenename in level.scenedefs)
	{
		s_scenedef = getscriptbundle(str_scenename);
		if(s_scenedef.vmtype === "server")
		{
			continue;
		}
		s_scenedef.editaction = undefined;
		s_scenedef.newobject = undefined;
		if(s_scenedef is_igc())
		{
			level.server_scenes[s_scenedef.name] = s_scenedef;
			continue;
		}
		if(s_scenedef.vmtype === "both")
		{
			n_clientbits = 3;
			clientfield::register("world", s_scenedef.name, 1, n_clientbits, "int", &cf_server_sync, 0, 0);
		}
	}
	switch(currentsessionmode())
	{
		case 2:
		{
			var_a093876d = 1;
			break;
		}
		case 1:
		{
			var_a093876d = 24;
			break;
		}
		case 0:
		{
			var_a093876d = 4;
			break;
		}
		case 3:
		{
			var_a093876d = 40;
			break;
		}
		default:
		{
			var_a093876d = 24;
			break;
		}
	}
	if(util::is_frontend_map())
	{
		var_a093876d = 24;
	}
	var_a093876d = int(min(32, var_a093876d));
	clientfield::register("toplayer", "postfx_igc", 1, 2, "counter", &postfx_igc, 0, 0);
	clientfield::register("world", "in_igc", 1, var_a093876d, "int", &in_igc, 0, 0);
	clientfield::register("toplayer", "postfx_cateye", 1, 1, "int", &postfx_cateye, 0, 0);
	clientfield::register("toplayer", "player_scene_skip_completed", 1, 2, "counter", &player_scene_skip_completed, 0, 0);
	clientfield::register("toplayer", "player_pbg_bank_scene_system", 1, getminbitcountfornum(3), "int", &player_pbg_bank_scene_system, 0, 0);
	clientfield::register("allplayers", "player_scene_animation_skip", 1, 2, "counter", &player_scene_animation_skip, 0, 0);
	clientfield::register("actor", "player_scene_animation_skip", 1, 2, "counter", &player_scene_animation_skip, 0, 0);
	clientfield::register("vehicle", "player_scene_animation_skip", 1, 2, "counter", &player_scene_animation_skip, 0, 0);
	clientfield::register("scriptmover", "player_scene_animation_skip", 1, 2, "counter", &player_scene_animation_skip, 0, 0);
	if(sessionmodeiscampaigngame())
	{
		level.interactive_shot = interactive_shot::register();
	}
	callback::on_localclient_shutdown(&on_localplayer_shutdown);
}

/*
	Name: player_pbg_bank_scene_system
	Namespace: scene
	Checksum: 0xA5100303
	Offset: 0x9C78
	Size: 0x112
	Parameters: 7
	Flags: Linked
*/
function player_pbg_bank_scene_system(localclientnum, oldval, newval, bnewent, binitialsnap, fieldname, bwastimejump)
{
	switch(bwastimejump)
	{
		case 0:
		{
			setpbgactivebank(fieldname, 1);
			break;
		}
		case 1:
		{
			setpbgactivebank(fieldname, 2);
			break;
		}
		case 2:
		{
			setpbgactivebank(fieldname, 4);
			break;
		}
		case 3:
		{
			setpbgactivebank(fieldname, 8);
			break;
		}
	}
}

/*
	Name: in_igc
	Namespace: scene
	Checksum: 0xDD1BFF1E
	Offset: 0x9D98
	Size: 0x234
	Parameters: 7
	Flags: Linked
*/
function in_igc(localclientnum, oldval, newval, bnewent, binitialsnap, fieldname, bwastimejump)
{
	player = function_5c10bd79(fieldname);
	n_entnum = player getentitynumber();
	b_igc_active = 0;
	if(bwastimejump & (1 << n_entnum))
	{
		b_igc_active = 1;
	}
	if(b_igc_active)
	{
		flushsubtitles(fieldname);
	}
	igcactive(fieldname, b_igc_active);
	level notify(#"igc_activated", {#b_active:b_igc_active});
	if(isarray(level.var_25e5c959))
	{
		foreach(var_ed8205c6 in level.var_25e5c959)
		{
			a_players = getplayers(fieldname);
			foreach(player in a_players)
			{
				if(isdefined(player))
				{
					player thread [[var_ed8205c6]](fieldname, b_igc_active);
				}
			}
		}
	}
	/#
	#/
}

/*
	Name: function_2e58158b
	Namespace: scene
	Checksum: 0x4821FB9
	Offset: 0x9FD8
	Size: 0x88
	Parameters: 1
	Flags: Linked
*/
function function_2e58158b(func_igc)
{
	if(!isdefined(level.var_25e5c959))
	{
		level.var_25e5c959 = [];
	}
	else if(!isarray(level.var_25e5c959))
	{
		level.var_25e5c959 = array(level.var_25e5c959);
	}
	level.var_25e5c959[level.var_25e5c959.size] = func_igc;
}

/*
	Name: function_e78401d1
	Namespace: scene
	Checksum: 0x17214F82
	Offset: 0xA068
	Size: 0x2C
	Parameters: 1
	Flags: None
*/
function function_e78401d1(func_igc)
{
	arrayremovevalue(level.var_25e5c959, func_igc);
}

/*
	Name: function_f9036ea7
	Namespace: scene
	Checksum: 0x2905D291
	Offset: 0xA0A0
	Size: 0xB4
	Parameters: 1
	Flags: Linked
*/
function function_f9036ea7(b_enable)
{
	if(!sessionmodeiscampaigngame())
	{
		return;
	}
	if(b_enable)
	{
		if(!is_true(self.var_c7329df1))
		{
			self.var_c7329df1 = 1;
			self postfx::playpostfxbundle("pstfx_catseye_cinematic");
		}
	}
	else if(is_true(self.var_c7329df1))
	{
		self.var_c7329df1 = undefined;
		self postfx::stoppostfxbundle("pstfx_catseye_cinematic");
	}
}

/*
	Name: postfx_cateye
	Namespace: scene
	Checksum: 0xA31C986A
	Offset: 0xA160
	Size: 0xB4
	Parameters: 7
	Flags: Linked
*/
function postfx_cateye(localclientnum, oldval, newval, bnewent, binitialsnap, fieldname, bwastimejump)
{
	player = function_5c10bd79(fieldname);
	level notify(#"sndlevelstartduck_shutoff");
	if(bwastimejump)
	{
		player function_f9036ea7(1);
	}
	else
	{
		player function_f9036ea7(0);
	}
}

/*
	Name: on_localplayer_shutdown
	Namespace: scene
	Checksum: 0x8665DC15
	Offset: 0xA220
	Size: 0x82
	Parameters: 1
	Flags: Linked, Private
*/
function private on_localplayer_shutdown(localclientnum)
{
	localplayer = self;
	codelocalplayer = function_5c10bd79(localclientnum);
	if(isdefined(localplayer) && isplayer(localplayer))
	{
		if(isdefined(codelocalplayer))
		{
			if(localplayer == codelocalplayer)
			{
				localplayer.postfx_igc_on = undefined;
				localplayer.pstfx_world_construction = 0;
			}
		}
	}
}

/*
	Name: postfx_igc
	Namespace: scene
	Checksum: 0x74D3B99D
	Offset: 0xA2B0
	Size: 0x6D6
	Parameters: 7
	Flags: Linked
*/
function postfx_igc(localclientnum, oldval, newval, bnewent, binitialsnap, fieldname, bwastimejump)
{
	self endon(#"death");
	if(is_true(self.postfx_igc_on))
	{
		return;
	}
	if(sessionmodeiszombiesgame())
	{
		postfx_igc_zombies(localclientnum);
		return;
	}
	if(newval == 3)
	{
		self thread postfx_igc_short(localclientnum, oldval, newval, bnewent, binitialsnap, fieldname, bwastimejump);
		return;
	}
	self.postfx_igc_on = 1;
	codeimagename = "postfx_igc_image" + localclientnum;
	createscenecodeimage(localclientnum, codeimagename);
	captureframe(localclientnum, codeimagename);
	n_hex = 0;
	b_streamer_wait = 1;
	i = 0;
	while(i < 2000)
	{
		st = float(i) / 1000;
		if(b_streamer_wait && st >= 0.65)
		{
			n_streamer_time_total = 0;
			while(!isstreamerready() && n_streamer_time_total < 5000)
			{
				n_streamer_time = gettime();
				j = int(0.65 * 1000);
				while(j < 1150)
				{
					jt = float(j) / 1000;
					waitframe(1);
					j = j + (int(0.016 * 1000));
				}
				j = int(1.15 * 1000);
				while(j < 650)
				{
					jt = float(j) / 1000;
					waitframe(1);
					j = j - (int(0.016 * 1000));
				}
				n_streamer_time_total = n_streamer_time_total + (gettime() - n_streamer_time);
			}
			b_streamer_wait = 0;
		}
		if(st <= 0.5)
		{
		}
		else if(st > 0.5 && st <= 0.85)
		{
		}
		if(newval == 2)
		{
			else
			{
			}
			if(st > 1 && !is_true(self.pstfx_world_construction))
			{
				self thread postfx::playpostfxbundle(#"pstfx_world_construction");
				self.pstfx_world_construction = 1;
			}
		}
		if(st > 0.5 && st <= 1)
		{
			n_hex = mapfloat(0.5, 1, 0, 1, st);
		}
		else if(st > 1 && st < 1.5)
		{
		}
		if(st > 0.65 && st <= 1.15)
		{
			else
			{
			}
		}
		else if(st > 1.21 && st < 1.5)
		{
		}
		if(st > 1.21 && st <= 1.5)
		{
			else
			{
			}
		}
		else
		{
		}
		if(st > 1 && st <= 1.45)
		{
		}
		else
		{
			if(st > 1.45 && st < 1.75)
			{
			}
			else
			{
			}
		}
		if(st >= 1.75)
		{
			val = 1 - mapfloat(1.75, 2, 0, 1, st);
		}
		if(st >= 1.25)
		{
			val = 1 - mapfloat(1.25, 1.75, 0, 1, st);
		}
		if(st > 1)
		{
			outer_radii = mapfloat(1, 1.5, 0, 2000, st);
		}
		if(st > 1.15 && st < 1.85)
		{
		}
		else
		{
		}
		waitframe(1);
		i = i + (int(0.016 * 1000));
	}
	self.pstfx_world_construction = 0;
	freecodeimage(localclientnum, codeimagename);
	self.postfx_igc_on = undefined;
}

/*
	Name: postfx_igc_zombies
	Namespace: scene
	Checksum: 0x2418E401
	Offset: 0xA990
	Size: 0x66
	Parameters: 1
	Flags: Linked
*/
function postfx_igc_zombies(localclientnum)
{
	level lui::screen_fade_out(localclientnum, 0, "black");
	waitframe(1);
	level lui::screen_fade_in(localclientnum, 0.3);
	self.postfx_igc_on = undefined;
}

/*
	Name: postfx_igc_short
	Namespace: scene
	Checksum: 0xC32C4EF2
	Offset: 0xAA00
	Size: 0x196
	Parameters: 7
	Flags: Linked
*/
function postfx_igc_short(localclientnum, oldval, newval, bnewent, binitialsnap, fieldname, bwastimejump)
{
	self endon(#"death");
	self.postfx_igc_on = 1;
	codeimagename = "postfx_igc_image" + bwastimejump;
	createscenecodeimage(bwastimejump, codeimagename);
	captureframe(bwastimejump, codeimagename);
	b_streamer_wait = 1;
	i = 0;
	while(i < 850)
	{
		st = float(i) / 1000;
		if(st <= 0.5)
		{
		}
		else if(st > 0.5 && st <= 0.85)
		{
		}
		waitframe(1);
		i = i + (int(0.016 * 1000));
	}
	freecodeimage(bwastimejump, codeimagename);
	self.postfx_igc_on = undefined;
}

/*
	Name: cf_server_sync
	Namespace: scene
	Checksum: 0x270E86FE
	Offset: 0xABA0
	Size: 0x1CA
	Parameters: 7
	Flags: Linked
*/
function cf_server_sync(localclientnum, oldval, newval, bnewent, binitialsnap, fieldname, bwastimejump)
{
	switch(fieldname)
	{
		case 0:
		{
			if(is_active(bwastimejump))
			{
				level thread stop(bwastimejump);
			}
			break;
		}
		case 1:
		{
			level thread init(bwastimejump);
			break;
		}
		case 2:
		{
			level thread play(bwastimejump);
			break;
		}
	}
	/#
		switch(fieldname)
		{
			case 3:
			{
				if(is_active(bwastimejump))
				{
					level thread stop(bwastimejump, 1, undefined, undefined, 1);
				}
				break;
			}
			case 4:
			{
				level thread init(bwastimejump, undefined, undefined, 1);
				break;
			}
			case 5:
			{
				level thread play(bwastimejump, undefined, undefined, 1);
				break;
			}
		}
	#/
}

/*
	Name: remove_invalid_scene_objects
	Namespace: scene
	Checksum: 0xFC4E4485
	Offset: 0xAD78
	Size: 0x150
	Parameters: 1
	Flags: None
*/
function remove_invalid_scene_objects(s_scenedef)
{
	a_invalid_object_indexes = [];
	if(isdefined(s_scenedef.objects))
	{
		foreach(s_object in s_scenedef.objects)
		{
			if(!isdefined(s_object.name) && !isdefined(s_object.model))
			{
				if(!isdefined(a_invalid_object_indexes))
				{
					a_invalid_object_indexes = [];
				}
				else if(!isarray(a_invalid_object_indexes))
				{
					a_invalid_object_indexes = array(a_invalid_object_indexes);
				}
				a_invalid_object_indexes[a_invalid_object_indexes.size] = i;
			}
		}
	}
	for(i = a_invalid_object_indexes.size - 1; i >= 0; i--)
	{
		arrayremoveindex(s_scenedef.objects, a_invalid_object_indexes[i]);
	}
	return s_scenedef;
}

/*
	Name: function_585fb738
	Namespace: scene
	Checksum: 0xD5A43C44
	Offset: 0xAED0
	Size: 0xCE
	Parameters: 2
	Flags: Linked
*/
function function_585fb738(str_scene, var_79fe29db)
{
	if(isdefined(str_scene))
	{
		s_bundle = getscriptbundle(str_scene);
	}
	else
	{
		s_bundle = self;
		str_scene = s_bundle.name;
	}
	if(is_true(s_bundle.igc))
	{
		return;
	}
	if(function_7aa3d2c6(str_scene) || get_player_count(str_scene) || is_true(var_79fe29db))
	{
		s_bundle.igc = 1;
	}
}

/*
	Name: is_igc
	Namespace: scene
	Checksum: 0x73AFCD60
	Offset: 0xAFA8
	Size: 0x1A
	Parameters: 0
	Flags: Linked
*/
function is_igc()
{
	return is_true(self.igc);
}

/*
	Name: function_9503138e
	Namespace: scene
	Checksum: 0x3FC05D7A
	Offset: 0xAFD0
	Size: 0x70
	Parameters: 1
	Flags: None
*/
function function_9503138e(object)
{
	if(!isdefined(object))
	{
		object = self;
	}
	if(object.classname === "scriptbundle_scene")
	{
		return true;
	}
	if(object.classname === "scriptbundle_fxanim")
	{
		return true;
	}
	if(object.variantname === "smart_object")
	{
		return true;
	}
	return false;
}

/*
	Name: function_6a0b0afe
	Namespace: scene
	Checksum: 0xF8471F90
	Offset: 0xB048
	Size: 0x36
	Parameters: 1
	Flags: Linked
*/
function function_6a0b0afe(str_mode)
{
	if(issubstr(str_mode, "single"))
	{
		return true;
	}
	return false;
}

/*
	Name: function_8ac3bea9
	Namespace: scene
	Checksum: 0xC69B85E8
	Offset: 0xB088
	Size: 0x538
	Parameters: 0
	Flags: Linked, Private
*/
function private function_8ac3bea9()
{
	util::function_89a98f85();
	if(isdefined(level.disablefxaniminsplitscreencount))
	{
		if(isdefined(level.localplayers))
		{
			if(level.localplayers.size >= level.disablefxaniminsplitscreencount)
			{
				return;
			}
		}
	}
	a_instances = arraycombine(struct::get_array("scriptbundle_scene", "classname"), struct::get_array("scriptbundle_fxanim", "classname"), 0, 0);
	a_instances = arraycombine(a_instances, struct::get_array("smart_object", "variantname"), 0, 0);
	foreach(s_instance in a_instances)
	{
		s_scenedef = getscriptbundle(s_instance.scriptbundlename);
		if(s_scenedef.vmtype !== "client")
		{
			continue;
		}
		if(isdefined(s_instance.scriptgroup_initscenes))
		{
			trigs = getentarray(0, s_instance.scriptgroup_initscenes, "scriptgroup_initscenes");
			if(isdefined(trigs))
			{
				foreach(trig in trigs)
				{
					s_instance thread _trigger_init(trig);
				}
			}
		}
		if(isdefined(s_instance.scriptgroup_playscenes))
		{
			trigs = getentarray(0, s_instance.scriptgroup_playscenes, "scriptgroup_playscenes");
			if(isdefined(trigs))
			{
				foreach(trig in trigs)
				{
					s_instance thread _trigger_play(trig);
				}
			}
		}
		if(isdefined(s_instance.scriptgroup_stopscenes))
		{
			trigs = getentarray(0, s_instance.scriptgroup_stopscenes, "scriptgroup_stopscenes");
			if(isdefined(trigs))
			{
				foreach(trig in trigs)
				{
					s_instance thread _trigger_stop(trig);
				}
			}
		}
	}
	foreach(s_instance in a_instances)
	{
		s_scenedef = get_scenedef(s_instance.scriptbundlename);
		/#
			assert(isdefined(s_scenedef), ((("" + s_instance.origin) + "") + s_instance.scriptbundlename) + "");
		#/
		if(s_scenedef.vmtype === "client")
		{
			if(isdefined(s_instance.spawnflags) && (s_instance.spawnflags & 2) == 2)
			{
				s_instance thread play();
				continue;
			}
			if(isdefined(s_instance.spawnflags) && (s_instance.spawnflags & 1) == 1)
			{
				s_instance thread init();
			}
		}
	}
}

/*
	Name: _trigger_init
	Namespace: scene
	Checksum: 0x599F76D6
	Offset: 0xB5C8
	Size: 0xB4
	Parameters: 1
	Flags: Linked
*/
function _trigger_init(trig)
{
	trig endon(#"death");
	s_waitresult = undefined;
	s_waitresult = trig waittill(#"trigger");
	a_ents = [];
	if(get_player_count(self.scriptbundlename) > 0)
	{
		if(isplayer(s_waitresult.activator))
		{
			a_ents[0] = s_waitresult.activator;
		}
	}
	self thread init(a_ents);
}

/*
	Name: _trigger_play
	Namespace: scene
	Checksum: 0xD659631B
	Offset: 0xB688
	Size: 0xE6
	Parameters: 1
	Flags: Linked
*/
function _trigger_play(trig)
{
	trig endon(#"death");
	do
	{
		s_waitresult = undefined;
		s_waitresult = trig waittill(#"trigger");
		a_ents = [];
		if(get_player_count(self.scriptbundlename) > 0)
		{
			if(isplayer(s_waitresult.activator))
			{
				a_ents[0] = s_waitresult.activator;
			}
		}
		self thread play(a_ents);
	}
	while(is_true(get_scenedef(self.scriptbundlename).looping));
}

/*
	Name: _trigger_stop
	Namespace: scene
	Checksum: 0x10F0D64A
	Offset: 0xB778
	Size: 0x54
	Parameters: 1
	Flags: Linked
*/
function _trigger_stop(trig)
{
	trig endon(#"death");
	trig waittill(#"trigger");
	self thread stop();
}

/*
	Name: add_scene_func
	Namespace: scene
	Checksum: 0x67F8AF3D
	Offset: 0xB7D8
	Size: 0x174
	Parameters: 4
	Flags: Linked, Variadic
*/
function add_scene_func(str_scenedef, func, var_e21c4c4c, ...)
{
	if(!isdefined(var_e21c4c4c))
	{
		var_e21c4c4c = "play";
	}
	/#
		/#
			assert(isdefined(getscriptbundle(str_scenedef)), ("" + function_9e72a96(str_scenedef)) + "");
		#/
	#/
	var_e21c4c4c = tolower(var_e21c4c4c);
	if(!isdefined(level.scene_funcs))
	{
		level.scene_funcs = [];
	}
	if(!isdefined(level.scene_funcs[str_scenedef]))
	{
		level.scene_funcs[str_scenedef] = [];
	}
	str_shot = function_c776e5bd(str_scenedef, var_e21c4c4c);
	if(!isdefined(level.scene_funcs[str_scenedef][str_shot]))
	{
		level.scene_funcs[str_scenedef][str_shot] = [];
	}
	array::add(level.scene_funcs[str_scenedef][str_shot], array(func, vararg), 0);
}

/*
	Name: remove_scene_func
	Namespace: scene
	Checksum: 0x999B9F47
	Offset: 0xB958
	Size: 0x17C
	Parameters: 3
	Flags: None
*/
function remove_scene_func(str_scenedef, func, var_e21c4c4c)
{
	if(!isdefined(var_e21c4c4c))
	{
		var_e21c4c4c = "play";
	}
	/#
		/#
			assert(isdefined(getscriptbundle(str_scenedef)), ("" + str_scenedef) + "");
		#/
	#/
	var_e21c4c4c = tolower(var_e21c4c4c);
	if(!isdefined(level.scene_funcs))
	{
		level.scene_funcs = [];
	}
	str_shot = function_c776e5bd(str_scenedef, var_e21c4c4c);
	if(isdefined(level.scene_funcs[str_scenedef]) && isdefined(level.scene_funcs[str_scenedef][str_shot]))
	{
		for(i = level.scene_funcs[str_scenedef][str_shot].size - 1; i >= 0; i--)
		{
			if(level.scene_funcs[str_scenedef][str_shot][i][0] == func)
			{
				arrayremoveindex(level.scene_funcs[str_scenedef][str_shot], i);
			}
		}
	}
}

/*
	Name: function_c776e5bd
	Namespace: scene
	Checksum: 0xC4235A5C
	Offset: 0xBAE0
	Size: 0x92
	Parameters: 2
	Flags: Linked, Private
*/
function private function_c776e5bd(str_scenedef, str_state)
{
	str_shot = str_state;
	if(str_state == "init")
	{
		str_shot = function_de6a7579(str_scenedef, "init");
	}
	else if(str_state == "play")
	{
		str_shot = function_de6a7579(str_scenedef, "play");
	}
	return str_shot;
}

/*
	Name: spawn
	Namespace: scene
	Checksum: 0xECB8BF06
	Offset: 0xBB80
	Size: 0x168
	Parameters: 5
	Flags: None
*/
function spawn(arg1, arg2, arg3, arg4, b_test_run)
{
	str_scenedef = arg1;
	/#
		assert(isdefined(str_scenedef), "");
	#/
	if(isvec(arg2))
	{
		v_origin = arg2;
		v_angles = arg3;
		a_ents = arg4;
	}
	else
	{
		a_ents = arg2;
		v_origin = arg3;
		v_angles = arg4;
	}
	s_instance = spawnstruct();
	s_instance.origin = (isdefined(v_origin) ? v_origin : (0, 0, 0));
	s_instance.angles = (isdefined(v_angles) ? v_angles : (0, 0, 0));
	s_instance.classname = "scriptbundle_scene";
	s_instance.scriptbundlename = str_scenedef;
	struct::init(s_instance);
	s_instance init(str_scenedef, a_ents, undefined, b_test_run);
	return s_instance;
}

/*
	Name: init
	Namespace: scene
	Checksum: 0x9960BB29
	Offset: 0xBCF0
	Size: 0x4C
	Parameters: 4
	Flags: Linked
*/
function init(arg1, arg2, arg3, b_test_run)
{
	self thread play(arg1, arg2, arg3, b_test_run, "init");
}

/*
	Name: get_scenedef
	Namespace: scene
	Checksum: 0xA011AD7
	Offset: 0xBD48
	Size: 0x88
	Parameters: 1
	Flags: Linked
*/
function get_scenedef(str_scenedef)
{
	s_scriptbundle = getscriptbundle(str_scenedef);
	/#
		/#
			assert(isdefined(s_scriptbundle) && isdefined(s_scriptbundle.objects), ("" + function_9e72a96(str_scenedef)) + "");
		#/
	#/
	return s_scriptbundle;
}

/*
	Name: get_scenedefs
	Namespace: scene
	Checksum: 0xE3AB7E7F
	Offset: 0xBDD8
	Size: 0x13A
	Parameters: 1
	Flags: None
*/
function get_scenedefs(str_type)
{
	if(!isdefined(str_type))
	{
		str_type = "scene";
	}
	a_scenedefs = [];
	foreach(str_scenedef in level.scenedefs)
	{
		s_scenedef = getscriptbundle(str_scenedef);
		if(s_scenedef.scenetype === str_type && s_scenedef.vmtype === "client")
		{
			if(!isdefined(a_scenedefs))
			{
				a_scenedefs = [];
			}
			else if(!isarray(a_scenedefs))
			{
				a_scenedefs = array(a_scenedefs);
			}
			a_scenedefs[a_scenedefs.size] = s_scenedef;
		}
	}
	return a_scenedefs;
}

/*
	Name: function_8d8ec9b5
	Namespace: scene
	Checksum: 0xD720A148
	Offset: 0xBF20
	Size: 0xA2
	Parameters: 3
	Flags: None
*/
function function_8d8ec9b5(str_scenedef, a_str_shot_names, s_instance)
{
	if(isdefined(s_instance))
	{
		s_instance.a_str_shot_names = a_str_shot_names;
		s_instance.var_418c40ac = a_str_shot_names[a_str_shot_names.size - 1];
	}
	else
	{
		s_scenedef = get_scenedef(str_scenedef);
		s_scenedef.a_str_shot_names = a_str_shot_names;
		level.var_1e798f4c[str_scenedef] = a_str_shot_names;
		s_scenedef.var_418c40ac = a_str_shot_names[a_str_shot_names.size - 1];
	}
}

/*
	Name: get_all_shot_names
	Namespace: scene
	Checksum: 0xCCF4EFD0
	Offset: 0xBFD0
	Size: 0x328
	Parameters: 3
	Flags: Linked
*/
function get_all_shot_names(str_scenedef, s_instance, var_8c4d2266)
{
	if(!isdefined(var_8c4d2266))
	{
		var_8c4d2266 = 0;
	}
	if(isdefined(s_instance) && isdefined(s_instance.a_str_shot_names))
	{
		a_shots = s_instance.a_str_shot_names;
		if(var_8c4d2266)
		{
			arrayremovevalue(a_shots, "init");
		}
		return a_shots;
	}
	if(isdefined(level.var_1e798f4c) && isdefined(level.var_1e798f4c[str_scenedef]))
	{
		a_shots = level.var_1e798f4c[str_scenedef];
		if(var_8c4d2266)
		{
			arrayremovevalue(a_shots, "init");
		}
		return a_shots;
	}
	s_scenedef = get_scenedef(str_scenedef);
	if(isdefined(s_scenedef.a_str_shot_names))
	{
		a_shots = s_scenedef.a_str_shot_names;
		if(var_8c4d2266)
		{
			arrayremovevalue(a_shots, "init");
		}
		return s_scenedef.a_str_shot_names;
	}
	a_shots = [];
	foreach(s_object in s_scenedef.objects)
	{
		if(!is_true(s_object.disabled) && isdefined(s_object.shots))
		{
			foreach(s_shot in s_object.shots)
			{
				if(!isdefined(a_shots))
				{
					a_shots = [];
				}
				else if(!isarray(a_shots))
				{
					a_shots = array(a_shots);
				}
				if(!isinarray(a_shots, s_shot.name))
				{
					a_shots[a_shots.size] = s_shot.name;
				}
			}
		}
	}
	s_scenedef.a_str_shot_names = a_shots;
	s_scenedef.var_418c40ac = a_shots[a_shots.size - 1];
	if(var_8c4d2266)
	{
		arrayremovevalue(a_shots, "init");
	}
	return a_shots;
}

/*
	Name: function_b260bdcc
	Namespace: scene
	Checksum: 0x53C30219
	Offset: 0xC300
	Size: 0x84
	Parameters: 3
	Flags: Linked
*/
function function_b260bdcc(str_scenedef, str_shot, s_instance)
{
	var_418c40ac = function_c9770402(str_scenedef, s_instance);
	s_scenedef = get_scenedef(str_scenedef);
	if(str_shot !== "init" && str_shot === var_418c40ac)
	{
		return true;
	}
	return false;
}

/*
	Name: function_c9770402
	Namespace: scene
	Checksum: 0x2476C9B1
	Offset: 0xC390
	Size: 0x126
	Parameters: 2
	Flags: Linked
*/
function function_c9770402(str_scenedef, s_instance)
{
	if(isdefined(s_instance) && isdefined(s_instance.var_418c40ac))
	{
		return s_instance.var_418c40ac;
	}
	if(isdefined(level.var_1e798f4c) && isdefined(level.var_1e798f4c[str_scenedef]))
	{
		a_shots = level.var_1e798f4c[str_scenedef];
		return a_shots[a_shots.size - 1];
	}
	s_scenedef = get_scenedef(str_scenedef);
	if(isdefined(s_scenedef.str_final_bundle))
	{
		return s_scenedef.str_final_bundle;
	}
	if(isdefined(s_scenedef.var_418c40ac))
	{
		return s_scenedef.var_418c40ac;
	}
	a_shots = get_all_shot_names(str_scenedef, s_instance);
	s_scenedef.var_418c40ac = a_shots[a_shots.size - 1];
	return a_shots[a_shots.size - 1];
}

/*
	Name: _init_instance
	Namespace: scene
	Checksum: 0xA6556F42
	Offset: 0xC4C0
	Size: 0x1D4
	Parameters: 3
	Flags: Linked
*/
function _init_instance(str_scenedef, a_ents, b_test_run)
{
	if(!isdefined(b_test_run))
	{
		b_test_run = 0;
	}
	if(!isdefined(str_scenedef))
	{
		str_scenedef = self.scriptbundlename;
	}
	s_bundle = get_scenedef(str_scenedef);
	if(!isdefined(s_bundle) || !function_6f382548(s_bundle, str_scenedef))
	{
		return;
	}
	/#
		/#
			assert(isdefined(str_scenedef), ("" + (isdefined(self.origin) ? self.origin : "")) + "");
		#/
		/#
			assert(isdefined(s_bundle), ((("" + (isdefined(self.origin) ? self.origin : "")) + "") + str_scenedef) + "");
		#/
	#/
	o_scene = get_active_scene(str_scenedef);
	if(isdefined(o_scene))
	{
		if(isdefined(self.scriptbundlename) && !b_test_run)
		{
			return o_scene;
		}
		thread [[ o_scene ]]->initialize(1);
	}
	else
	{
		o_scene = new cscene();
		[[ o_scene ]]->init(str_scenedef, s_bundle, self, a_ents, b_test_run);
	}
	return o_scene;
}

/*
	Name: function_6f382548
	Namespace: scene
	Checksum: 0xBA6DD449
	Offset: 0xC6A0
	Size: 0x1CC
	Parameters: 2
	Flags: Linked
*/
function function_6f382548(struct, str_scene_name)
{
	if(!isdefined(struct.disableinsplitscreen) || !(getdvarint(#"splitscreen_playercount", 1) > 1))
	{
		return true;
	}
	if(struct.disableinsplitscreen == 2 && getdvarint(#"splitscreen_playercount", 1) > 1 || (struct.disableinsplitscreen == 3 && getdvarint(#"splitscreen_playercount", 1) > 2) || (struct.disableinsplitscreen == 4 && getdvarint(#"splitscreen_playercount", 1) > 3))
	{
		/#
			if(struct.type === "")
			{
				str_debug = ("" + function_9e72a96(str_scene_name)) + "";
			}
			else
			{
				str_debug = ((("" + function_9e72a96(struct.name)) + "") + str_scene_name) + "";
			}
			println(str_debug);
		#/
		return false;
	}
	return true;
}

/*
	Name: function_de6a7579
	Namespace: scene
	Checksum: 0xDBAB3FE7
	Offset: 0xC878
	Size: 0x10E
	Parameters: 3
	Flags: Linked
*/
function function_de6a7579(str_scenedef, str_mode, s_instance)
{
	a_shots = get_all_shot_names(str_scenedef, s_instance);
	if(a_shots.size == 0)
	{
		return "play";
	}
	if(str_mode !== "init")
	{
		if(a_shots[0] !== "init")
		{
			str_shot = a_shots[0];
		}
		else if(a_shots.size > 1)
		{
			str_shot = a_shots[1];
		}
	}
	else if(str_mode === "init")
	{
		if(isinarray(a_shots, "init"))
		{
			str_shot = "init";
		}
		else
		{
			str_shot = a_shots[0];
		}
	}
	if(!isdefined(str_shot))
	{
		str_shot = "play";
	}
	return str_shot;
}

/*
	Name: play_from_time
	Namespace: scene
	Checksum: 0x2303E88B
	Offset: 0xC990
	Size: 0xF4
	Parameters: 7
	Flags: Linked
*/
function play_from_time(arg1, arg2, arg3, n_time, var_c9d6bbb, var_20dda4d1, params)
{
	if(!isdefined(var_c9d6bbb))
	{
		var_c9d6bbb = 1;
	}
	if(!isdefined(var_20dda4d1))
	{
		var_20dda4d1 = 0;
	}
	if(var_c9d6bbb)
	{
		str_mode = "play_from_time_normalized";
	}
	else
	{
		str_mode = "play_from_time_elapsed";
	}
	if(function_d3e3e0c7(arg1) || function_d3e3e0c7(arg2) && var_20dda4d1)
	{
		str_mode = str_mode + "_single";
	}
	play(arg1, arg2, arg3, 0, str_mode, n_time, params);
}

/*
	Name: function_d3e3e0c7
	Namespace: scene
	Checksum: 0xF34AF7CD
	Offset: 0xCA90
	Size: 0x9A
	Parameters: 1
	Flags: Linked
*/
function function_d3e3e0c7(arg)
{
	if(isstring(arg) && !isinarray(level.scenedefs, hash(arg)) && !isinarray(array("targetname", "script_noteworthy"), arg))
	{
		return true;
	}
	return false;
}

/*
	Name: function_d1abba8b
	Namespace: scene
	Checksum: 0x9B29F798
	Offset: 0xCB38
	Size: 0x19A
	Parameters: 5
	Flags: Linked
*/
function function_d1abba8b(str_scenedef, str_shot, str_mode, n_time, var_5b51581a)
{
	if(!isdefined(var_5b51581a))
	{
		var_5b51581a = 0;
	}
	var_8b21886e = spawnstruct();
	if(issubstr(str_mode, "play_from_time_normalized"))
	{
		if(var_5b51581a)
		{
			var_8b21886e.var_ef711d04 = str_shot;
			var_8b21886e.var_3486c904 = float(n_time);
			return var_8b21886e;
		}
		var_f3f679dd = float(n_time) * function_12479eba(str_scenedef);
	}
	else if(issubstr(str_mode, "play_from_time_elapsed"))
	{
		if(var_5b51581a)
		{
			var_c74251a4 = function_8582657c(str_scenedef, str_shot);
			var_8b21886e.var_ef711d04 = str_shot;
			var_8b21886e.var_3486c904 = float(n_time) / var_c74251a4;
			return var_8b21886e;
		}
		var_f3f679dd = float(n_time);
	}
	var_8b21886e = function_dde5f483(str_scenedef, var_f3f679dd);
	return var_8b21886e;
}

/*
	Name: function_1eab8670
	Namespace: scene
	Checksum: 0x53CD16FA
	Offset: 0xCCE0
	Size: 0x21A
	Parameters: 2
	Flags: Linked
*/
function function_1eab8670(obj, str_shot)
{
	var_5a162d58 = 0;
	n_anim_length = 0;
	if(isdefined(obj.shots))
	{
		foreach(s_shot in obj.shots)
		{
			if(is_true(s_shot.var_51093f2d))
			{
				continue;
			}
			if(s_shot.name === str_shot && isdefined(s_shot.entry))
			{
				foreach(s_entry in s_shot.entry)
				{
					if(isdefined(s_entry.cameraswitcher))
					{
						var_5a162d58 = var_5a162d58 + (float(getcamanimtime(s_entry.cameraswitcher)) / 1000);
						continue;
					}
					if(isdefined(s_entry.anim))
					{
						n_anim_length = n_anim_length + getanimlength(s_entry.anim);
					}
				}
				break;
			}
		}
	}
	n_length = max(var_5a162d58, n_anim_length);
	return n_length;
}

/*
	Name: function_dde5f483
	Namespace: scene
	Checksum: 0x741E31B3
	Offset: 0xCF08
	Size: 0x23A
	Parameters: 2
	Flags: Linked
*/
function function_dde5f483(str_scenedef, n_elapsed_time)
{
	s_scenedef = get_scenedef(str_scenedef);
	a_shots = get_all_shot_names(str_scenedef, undefined, 1);
	var_7a2504a = 0;
	var_8b21886e = spawnstruct();
	foreach(str_shot in a_shots)
	{
		var_958bccd3 = 0;
		foreach(obj in s_scenedef.objects)
		{
			var_657b76cc = function_1eab8670(obj, str_shot);
			if(var_657b76cc > var_958bccd3)
			{
				var_958bccd3 = var_657b76cc;
			}
		}
		var_219aac3f = var_7a2504a;
		var_68790830 = var_219aac3f + var_958bccd3;
		if(n_elapsed_time >= var_219aac3f && n_elapsed_time < var_68790830)
		{
			var_8b21886e.var_ef711d04 = str_shot;
			var_8b21886e.var_3486c904 = (n_elapsed_time - var_219aac3f) / var_958bccd3;
			return var_8b21886e;
		}
		var_7a2504a = var_7a2504a + var_958bccd3;
	}
	var_8b21886e.var_ef711d04 = a_shots[a_shots.size - 1];
	var_8b21886e.var_3486c904 = 0.9;
	return var_8b21886e;
}

/*
	Name: function_8582657c
	Namespace: scene
	Checksum: 0xF5F25DB5
	Offset: 0xD150
	Size: 0x126
	Parameters: 2
	Flags: Linked
*/
function function_8582657c(var_b9a72490, str_shot)
{
	if(isstring(var_b9a72490) || ishash(var_b9a72490))
	{
		s_scenedef = get_scenedef(var_b9a72490);
	}
	else
	{
		s_scenedef = var_b9a72490;
	}
	var_a0c66830 = 0;
	foreach(obj in s_scenedef.objects)
	{
		var_657b76cc = function_1eab8670(obj, str_shot);
		if(var_657b76cc > var_a0c66830)
		{
			var_a0c66830 = var_657b76cc;
		}
	}
	return var_a0c66830;
}

/*
	Name: function_12479eba
	Namespace: scene
	Checksum: 0x48BF5A3C
	Offset: 0xD280
	Size: 0xF8
	Parameters: 1
	Flags: Linked
*/
function function_12479eba(str_scenedef)
{
	s_scenedef = get_scenedef(str_scenedef);
	a_shots = get_all_shot_names(str_scenedef, undefined, 1);
	var_9d90ef8b = 0;
	foreach(str_shot in a_shots)
	{
		var_9d90ef8b = var_9d90ef8b + function_8582657c(s_scenedef, str_shot);
	}
	return var_9d90ef8b;
}

/*
	Name: function_67e52759
	Namespace: scene
	Checksum: 0x8EAF2379
	Offset: 0xD380
	Size: 0xCA
	Parameters: 5
	Flags: None
*/
function function_67e52759(str_scenedef, s_instance, var_8c4d2266, var_47f77330, var_62e8e2f0)
{
	a_shots = get_all_shot_names(str_scenedef, s_instance, var_8c4d2266);
	if(isdefined(var_47f77330) || isdefined(var_62e8e2f0))
	{
		a_shots = array::slice(a_shots, (isdefined(var_47f77330) ? var_47f77330 : 0), (isdefined(var_62e8e2f0) ? var_62e8e2f0 : 2147483647));
	}
	s_shot = array::random(a_shots);
	return s_shot;
}

/*
	Name: play
	Namespace: scene
	Checksum: 0x1842D64D
	Offset: 0xD458
	Size: 0x474
	Parameters: 7
	Flags: Linked
*/
function play(arg1, arg2, arg3, b_test_run, str_mode, n_time, params)
{
	if(!isdefined(b_test_run))
	{
		b_test_run = 0;
	}
	if(!isdefined(str_mode))
	{
		str_mode = "";
	}
	s_tracker = spawnstruct();
	s_tracker.n_scene_count = 1;
	if(self == level)
	{
		a_instances = [];
		if(isstring(arg1) || ishash(arg1))
		{
			if(isstring(arg1) && issubstr(arg1, ","))
			{
				a_toks = strtok(arg1, ",");
				str_value = a_toks[0];
				str_key = a_toks[1];
				if(isstring(arg2))
				{
					str_shot = tolower(arg2);
					a_ents = arg3;
					var_5b51581a = 1;
				}
				else
				{
					a_ents = arg2;
				}
			}
			else
			{
				if(isinarray(level.scenedefs, hash(arg1)))
				{
					str_scenedef = arg1;
					var_583db6f0 = 1;
				}
				else
				{
					str_value = arg1;
					str_key = "targetname";
				}
			}
			if(isstring(arg2))
			{
				if(isinarray(array("targetname", "script_noteworthy"), arg2))
				{
					str_key = arg2;
				}
				else
				{
					str_shot = tolower(arg2);
					var_5b51581a = 1;
				}
				a_ents = arg3;
			}
			else
			{
				a_ents = arg2;
			}
			a_instances = _get_scene_instances(str_value, str_key, str_scenedef);
			if(a_instances.size)
			{
				s_tracker.n_scene_count = a_instances.size;
				foreach(s_instance in a_instances)
				{
					if(isdefined(s_instance))
					{
						if(!is_true(var_583db6f0))
						{
							str_scenedef = s_instance.scriptbundlename;
						}
						if(!is_true(var_5b51581a))
						{
							str_shot = function_de6a7579(str_scenedef, str_mode, s_instance);
						}
						else if(!issubstr(str_mode, "play_from_time"))
						{
							str_mode = "single";
						}
						s_instance thread _play_instance(s_tracker, str_scenedef, a_ents, b_test_run, str_shot, str_mode, n_time, var_5b51581a, params);
					}
				}
			}
			else
			{
				_play_on_self(s_tracker, arg1, arg2, arg3, b_test_run, str_mode, n_time, params);
			}
		}
	}
	else
	{
		_play_on_self(s_tracker, arg1, arg2, arg3, b_test_run, str_mode, n_time, params);
	}
	function_c802b491(s_tracker, str_mode);
}

/*
	Name: function_c802b491
	Namespace: scene
	Checksum: 0x454A84BA
	Offset: 0xD8D8
	Size: 0x84
	Parameters: 2
	Flags: Linked, Private
*/
function private function_c802b491(s_tracker, str_mode)
{
	level endon(#"demo_jump");
	if(s_tracker.n_scene_count > 0 && !is_true(s_tracker.var_93ec5dde) && str_mode !== "init")
	{
		s_tracker waittill(#"scene_done");
	}
}

/*
	Name: function_46546b5c
	Namespace: scene
	Checksum: 0x53F63032
	Offset: 0xD968
	Size: 0xBA
	Parameters: 2
	Flags: Linked
*/
function function_46546b5c(s_tracker, str_scenedef)
{
	if(getdvarint(#"hash_862358d532e674c", 0) === 1)
	{
		var_41c1a1b7 = getscriptbundle(str_scenedef);
		if(is_true(var_41c1a1b7.var_2af733c9))
		{
			/#
				iprintlnbold("" + str_scenedef);
			#/
			s_tracker.var_93ec5dde = 1;
			return true;
		}
	}
	return false;
}

/*
	Name: _play_on_self
	Namespace: scene
	Checksum: 0xF63F09A4
	Offset: 0xDA30
	Size: 0x294
	Parameters: 8
	Flags: Linked
*/
function _play_on_self(s_tracker, arg1, arg2, arg3, b_test_run, str_mode, n_time, params)
{
	if(!isdefined(b_test_run))
	{
		b_test_run = 0;
	}
	if(!isdefined(str_mode))
	{
		str_mode = "";
	}
	if(isstring(arg1) || ishash(arg1))
	{
		if(isinarray(level.scenedefs, hash(arg1)))
		{
			str_scenedef = arg1;
			if(isstring(arg2))
			{
				str_shot = arg2;
				a_ents = arg3;
			}
			else
			{
				a_ents = arg2;
			}
		}
		else
		{
			str_shot = arg1;
			a_ents = arg2;
		}
	}
	else
	{
		if(isarray(arg1))
		{
			str_scenedef = self.scriptbundlename;
			a_ents = arg1;
		}
		else
		{
			str_scenedef = self.scriptbundlename;
			if(isstring(arg2))
			{
				str_shot = arg2;
				a_ents = arg3;
			}
		}
	}
	s_tracker.n_scene_count = 1;
	if(!isdefined(str_shot) && isdefined(str_scenedef))
	{
		str_shot = function_de6a7579(str_scenedef, str_mode, self);
	}
	else if(isdefined(str_shot))
	{
		/#
			if(str_mode === "")
			{
				iprintlnbold("");
				println("");
			}
		#/
		if(str_mode !== "init" && !issubstr(str_mode, "play_from_time"))
		{
			str_mode = "single";
		}
		var_5b51581a = 1;
	}
	self thread _play_instance(s_tracker, str_scenedef, a_ents, b_test_run, str_shot, str_mode, n_time, var_5b51581a, params);
}

/*
	Name: _play_instance
	Namespace: scene
	Checksum: 0x364CB71F
	Offset: 0xDCD0
	Size: 0x3E0
	Parameters: 9
	Flags: Linked
*/
function _play_instance(s_tracker, str_scenedef, a_ents, b_test_run, str_shot, str_mode, n_time, var_5b51581a, params)
{
	if(!isdefined(str_shot))
	{
		str_shot = "play";
	}
	if(!isdefined(str_scenedef))
	{
		str_scenedef = self.scriptbundlename;
	}
	if(isdefined(n_time) && issubstr(str_mode, "play_from_time"))
	{
		var_8b21886e = function_d1abba8b(str_scenedef, str_shot, str_mode, n_time, var_5b51581a);
		str_shot = var_8b21886e.var_ef711d04;
		var_dd2b75b = var_8b21886e.var_3486c904;
		str_mode = str_mode + (":" + var_dd2b75b);
	}
	if(str_mode === "init")
	{
		str_shot = function_de6a7579(str_scenedef, str_mode, self);
	}
	if(function_46546b5c(s_tracker, str_scenedef))
	{
		waitframe(1);
		self notify(#"scene_done");
		return;
	}
	if(self.scriptbundlename === str_scenedef)
	{
		str_scenedef = self.scriptbundlename;
		if(!is_true(self.script_play_multiple))
		{
			if(!isdefined(self.scene_played))
			{
				self.scene_played = [];
			}
			if(is_true(self.scene_played[str_shot]) && !b_test_run)
			{
				waittillframeend();
				while(is_playing(str_scenedef))
				{
					waitframe(1);
				}
				/#
					println(("" + str_scenedef) + "");
				#/
				s_tracker notify(#"scene_done");
				return;
			}
		}
		if(str_mode == "init")
		{
			self.scene_played[str_shot] = 0;
		}
		else
		{
			self.scene_played[str_shot] = 1;
		}
	}
	o_scene = _init_instance(str_scenedef, a_ents, b_test_run);
	/#
		function_8ee42bf(o_scene);
	#/
	if(str_mode != "init")
	{
		if(!is_true(self.var_135bd649))
		{
			util::function_35840de8(self.script_delay);
		}
		if(isdefined(o_scene))
		{
			thread [[ o_scene ]]->play(str_shot, b_test_run, str_mode, undefined, params);
			if(isdefined(o_scene._a_objects) && o_scene._a_objects.size)
			{
				o_scene waittill_instance_scene_done(str_scenedef);
			}
		}
		if(isdefined(self))
		{
			if(isdefined(self.scriptbundlename) && is_true(get_scenedef(self.scriptbundlename).looping))
			{
				self.scene_played[str_shot] = 0;
			}
		}
	}
	/#
		function_8ee42bf(o_scene);
	#/
	s_tracker.n_scene_count--;
	s_tracker notify(#"scene_done");
}

/*
	Name: waittill_instance_scene_done
	Namespace: scene
	Checksum: 0xBEFBE40
	Offset: 0xE0B8
	Size: 0x3A
	Parameters: 1
	Flags: Linked, Private
*/
function private waittill_instance_scene_done(str_scenedef)
{
	level endon(#"demo_jump");
	self waittill(#"scene_done");
}

/*
	Name: stop
	Namespace: scene
	Checksum: 0xE46EDEA7
	Offset: 0xE100
	Size: 0x2B4
	Parameters: 5
	Flags: Linked
*/
function stop(arg1, arg2, arg3, b_cancel, b_no_assert)
{
	if(!isdefined(b_no_assert))
	{
		b_no_assert = 0;
	}
	if(self == level)
	{
		if(isstring(arg1) || ishash(arg1))
		{
			if(isstring(arg2))
			{
				str_value = arg1;
				str_key = arg2;
				b_clear = arg3;
			}
			else
			{
				str_value = arg1;
				b_clear = arg2;
			}
			if(isdefined(str_key))
			{
				a_instances = struct::get_array(str_value, str_key);
				/#
					/#
						assert(b_no_assert || a_instances.size, ((("" + str_key) + "") + str_value) + "");
					#/
				#/
				str_value = undefined;
			}
			else
			{
				a_instances = struct::get_array(str_value, "targetname");
				if(!a_instances.size)
				{
					a_instances = get_active_scenes(str_value);
				}
				else
				{
					str_value = undefined;
				}
			}
			foreach(s_instance in arraycopy(a_instances))
			{
				if(isdefined(s_instance))
				{
					s_instance _stop_instance(b_clear, str_value, b_cancel);
				}
			}
		}
	}
	else
	{
		if(isstring(arg1) || ishash(arg1))
		{
			_stop_instance(arg2, arg1, b_cancel);
		}
		else
		{
			_stop_instance(arg1, arg2, b_cancel);
		}
	}
}

/*
	Name: _stop_instance
	Namespace: scene
	Checksum: 0x4110C673
	Offset: 0xE3C0
	Size: 0x100
	Parameters: 3
	Flags: Linked
*/
function _stop_instance(b_clear, str_scenedef, b_cancel)
{
	if(!isdefined(b_clear))
	{
		b_clear = 0;
	}
	if(!isdefined(b_cancel))
	{
		b_cancel = 0;
	}
	if(isdefined(self.scenes))
	{
		foreach(o_scene in arraycopy(self.scenes))
		{
			str_scene_name = o_scene._str_name;
			if(!isdefined(str_scenedef) || str_scene_name == str_scenedef)
			{
				thread [[ o_scene ]]->stop(b_clear, b_cancel);
			}
		}
	}
}

/*
	Name: cancel
	Namespace: scene
	Checksum: 0xDFC102A0
	Offset: 0xE4C8
	Size: 0x3C
	Parameters: 3
	Flags: Linked
*/
function cancel(arg1, arg2, arg3)
{
	stop(arg1, arg2, arg3, 1);
}

/*
	Name: delete_scene_spawned_ents
	Namespace: scene
	Checksum: 0x95E06F
	Offset: 0xE510
	Size: 0x24C
	Parameters: 2
	Flags: None
*/
function delete_scene_spawned_ents(localclientnum, arg1)
{
	if(self == level)
	{
		a_instances = [];
		if(isstring(arg1) || ishash(arg1))
		{
			if(isstring(arg1) && issubstr(arg1, ","))
			{
				a_toks = strtok(arg1, ",");
				str_value = a_toks[0];
				str_key = a_toks[1];
			}
			else
			{
				if(isinarray(level.scenedefs, hash(arg1)))
				{
					str_scenedef = arg1;
				}
				else
				{
					str_value = arg1;
					str_key = "targetname";
				}
			}
			a_instances = _get_scene_instances(str_value, str_key, str_scenedef, 1);
			if(a_instances.size)
			{
				foreach(instance in a_instances)
				{
					instance _delete_scene_spawned_ents(localclientnum, str_scenedef);
				}
			}
		}
	}
	else
	{
		if(isstring(arg1) || ishash(arg1))
		{
			str_scenedef = arg1;
		}
		self _delete_scene_spawned_ents(localclientnum, str_scenedef);
	}
}

/*
	Name: _delete_scene_spawned_ents
	Namespace: scene
	Checksum: 0x9A2411A7
	Offset: 0xE768
	Size: 0xF0
	Parameters: 2
	Flags: Linked
*/
function _delete_scene_spawned_ents(localclientnum, str_scene)
{
	if(isarray(self.scene_ents) && isarray(self.scene_ents[str_scene]))
	{
		foreach(ent in self.scene_ents[str_scene])
		{
			if(isdefined(ent) && isdefined(ent.scene_spawned))
			{
				ent delete();
			}
		}
	}
}

/*
	Name: has_init_state
	Namespace: scene
	Checksum: 0xD40168CA
	Offset: 0xE860
	Size: 0xE4
	Parameters: 1
	Flags: None
*/
function has_init_state(str_scenedef)
{
	s_scenedef = get_scenedef(str_scenedef);
	foreach(s_obj in s_scenedef.objects)
	{
		if(!is_true(s_obj.disabled) && s_obj _has_init_state(str_scenedef))
		{
			return true;
		}
	}
	return false;
}

/*
	Name: _has_init_state
	Namespace: scene
	Checksum: 0x4528C3EC
	Offset: 0xE950
	Size: 0x8C
	Parameters: 1
	Flags: Linked
*/
function _has_init_state(str_scenedef)
{
	return isinarray(get_all_shot_names(str_scenedef), "init") || is_true(self.spawnoninit) || isdefined(self.initanim) || isdefined(self.initanimloop) || is_true(self.firstframe);
}

/*
	Name: get_prop_count
	Namespace: scene
	Checksum: 0xB90448EE
	Offset: 0xE9E8
	Size: 0x22
	Parameters: 1
	Flags: None
*/
function get_prop_count(str_scenedef)
{
	return _get_type_count("prop", str_scenedef);
}

/*
	Name: get_vehicle_count
	Namespace: scene
	Checksum: 0x185FE9BA
	Offset: 0xEA18
	Size: 0x22
	Parameters: 1
	Flags: None
*/
function get_vehicle_count(str_scenedef)
{
	return _get_type_count("vehicle", str_scenedef);
}

/*
	Name: get_actor_count
	Namespace: scene
	Checksum: 0xC817101D
	Offset: 0xEA48
	Size: 0x22
	Parameters: 1
	Flags: None
*/
function get_actor_count(str_scenedef)
{
	return _get_type_count("actor", str_scenedef);
}

/*
	Name: function_7aa3d2c6
	Namespace: scene
	Checksum: 0x6A29FEE2
	Offset: 0xEA78
	Size: 0x22
	Parameters: 1
	Flags: Linked
*/
function function_7aa3d2c6(str_scenedef)
{
	return _get_type_count("sharedplayer", str_scenedef);
}

/*
	Name: get_player_count
	Namespace: scene
	Checksum: 0x5C00EE2E
	Offset: 0xEAA8
	Size: 0x22
	Parameters: 1
	Flags: Linked
*/
function get_player_count(str_scenedef)
{
	return _get_type_count("player", str_scenedef);
}

/*
	Name: _get_type_count
	Namespace: scene
	Checksum: 0x6DC688A7
	Offset: 0xEAD8
	Size: 0x11C
	Parameters: 2
	Flags: Linked
*/
function _get_type_count(str_type, str_scenedef)
{
	s_scenedef = (isdefined(str_scenedef) ? get_scenedef(str_scenedef) : get_scenedef(self.scriptbundlename));
	n_count = 0;
	foreach(s_obj in s_scenedef.objects)
	{
		if(isdefined(s_obj.type))
		{
			if(tolower(s_obj.type) == tolower(str_type))
			{
				n_count++;
			}
		}
	}
	return n_count;
}

/*
	Name: is_active
	Namespace: scene
	Checksum: 0x7A9315E2
	Offset: 0xEC00
	Size: 0x4C
	Parameters: 1
	Flags: Linked
*/
function is_active(str_scenedef)
{
	if(self == level)
	{
		return get_active_scenes(str_scenedef).size > 0;
	}
	return isdefined(get_active_scene(str_scenedef));
}

/*
	Name: is_playing
	Namespace: scene
	Checksum: 0xCD812B00
	Offset: 0xEC58
	Size: 0x104
	Parameters: 2
	Flags: Linked
*/
function is_playing(str_scenedef, str_shot)
{
	if(self == level)
	{
		if(isarray(level.active_scenes[str_scenedef]) && isdefined(str_shot))
		{
			o_scene = level.active_scenes[str_scenedef][0].scenes[0];
			if(o_scene._str_shot === str_shot)
			{
				return 1;
			}
			return 0;
		}
		return level flag::get(str_scenedef + "_playing");
	}
	if(!isdefined(str_scenedef))
	{
		str_scenedef = self.scriptbundlename;
	}
	o_scene = get_active_scene(str_scenedef);
	if(isdefined(o_scene))
	{
		return o_scene._str_mode === "play";
	}
	return 0;
}

/*
	Name: get_active_scenes
	Namespace: scene
	Checksum: 0x8E4C39E5
	Offset: 0xED68
	Size: 0x106
	Parameters: 1
	Flags: Linked
*/
function get_active_scenes(str_scenedef)
{
	if(!isdefined(level.active_scenes))
	{
		level.active_scenes = [];
	}
	if(isdefined(str_scenedef))
	{
		return (isdefined(level.active_scenes[str_scenedef]) ? level.active_scenes[str_scenedef] : []);
	}
	a_active_scenes = [];
	foreach(str_scenedef, _ in level.active_scenes)
	{
		a_active_scenes = arraycombine(a_active_scenes, level.active_scenes[str_scenedef], 0, 0);
	}
	return a_active_scenes;
}

/*
	Name: get_active_scene
	Namespace: scene
	Checksum: 0x661FFCAD
	Offset: 0xEE78
	Size: 0xAA
	Parameters: 1
	Flags: Linked
*/
function get_active_scene(str_scenedef)
{
	if(isdefined(str_scenedef) && isdefined(self.scenes))
	{
		foreach(o_scene in self.scenes)
		{
			if(o_scene._str_name == str_scenedef)
			{
				return o_scene;
			}
		}
	}
}

/*
	Name: is_capture_mode
	Namespace: scene
	Checksum: 0x99BFE662
	Offset: 0xEF30
	Size: 0x62
	Parameters: 0
	Flags: None
*/
function is_capture_mode()
{
	str_mode = getdvarstring(#"scene_menu_mode", "default");
	if(issubstr(str_mode, "capture"))
	{
		return true;
	}
	return false;
}

/*
	Name: _get_scene_instances
	Namespace: scene
	Checksum: 0xA6072748
	Offset: 0xEFA0
	Size: 0x19A
	Parameters: 4
	Flags: Linked
*/
function _get_scene_instances(str_value, str_key, str_scenedef, b_include_inactive)
{
	if(!isdefined(str_key))
	{
		str_key = "targetname";
	}
	if(!isdefined(b_include_inactive))
	{
		b_include_inactive = 0;
	}
	a_instances = [];
	if(isdefined(str_value))
	{
		a_instances = struct::get_array(str_value, str_key);
		/#
			/#
				assert(a_instances.size, ((("" + str_key) + "") + str_value) + "");
			#/
		#/
	}
	if(isdefined(str_scenedef))
	{
		a_instances_by_scenedef = struct::get_array(str_scenedef, "scriptbundlename");
		a_instances = arraycombine(a_instances_by_scenedef, a_instances, 0, 0);
		a_active_instances = get_active_scenes(str_scenedef);
		a_instances = arraycombine(a_active_instances, a_instances, 0, 0);
		if(b_include_inactive)
		{
			a_inactive_instances = get_inactive_scenes(str_scenedef);
			a_instances = arraycombine(a_inactive_instances, a_instances, 0, 0);
		}
	}
	return a_instances;
}

/*
	Name: get_inactive_scenes
	Namespace: scene
	Checksum: 0x4BADB1F3
	Offset: 0xF148
	Size: 0x106
	Parameters: 1
	Flags: Linked
*/
function get_inactive_scenes(str_scenedef)
{
	if(!isdefined(level.inactive_scenes))
	{
		level.inactive_scenes = [];
	}
	if(isdefined(str_scenedef))
	{
		return (isdefined(level.inactive_scenes[str_scenedef]) ? level.inactive_scenes[str_scenedef] : []);
	}
	a_scenes = [];
	foreach(str_scenedef, _ in level.inactive_scenes)
	{
		a_scenes = arraycombine(a_scenes, level.inactive_scenes[str_scenedef], 0, 0);
	}
	return a_scenes;
}

/*
	Name: function_9730988a
	Namespace: scene
	Checksum: 0x11D67631
	Offset: 0xF258
	Size: 0x3A
	Parameters: 2
	Flags: Linked
*/
function function_9730988a(str_scenedef, str_shotname)
{
	return isinarray(get_all_shot_names(str_scenedef), str_shotname);
}

